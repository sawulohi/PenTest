Testaukset tehty Windows 10 käyttöjärjestelmällä, Version 10.0.19045 Build 19045. Tämän lisäksi käytetty myös Kali Linux versio 2023.3 ajettuna VirtualBox Version 7.0.12 r159484 (Qt5.15.2) kautta,  Prosessorina Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz, 16GB RAM

[https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h7-hash](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h7-hash)

---

#### x) Lue/katso/kuuntele ja tiivistä. 

##### Karvinen 2022: [Cracking Passwords with Hashcat](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/)
  - Salasanoja ei tallenneta järjestelmiin alkuperäisessä muodossa, vaan tiivisteinä.
  - Hashaaminen on yksisuuntainen funktio, eli sitä ei voi peruuttaa
  - Tiivisteiden purkaminen perustuu vertailuun, jossa kohdetiivistettä vertaillaan sanakirjasta johdettuihin tiivisteisiin
  - Hashcat on ohjelma, joka tekee tälläistä vertailua
  - Asennus ja käyttöönotto:
      
```

// Päivitä ja asenna
$ sudo apt-get update
$ sudo apt-get -y install hashid hashcat wget
// Tee hakemisto työskentelyä varten ja siirry sinne
$ mkdir hashed
$ cd hashed
// Hanki iso sanakirja, esim. yksi suosituimpia on rockyou
$ wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz
$ tar xf rockyou.txt.tar.gz
$ rm rockyou.txt.tar.gz

```

  - Rockyou on sanakirja, jossa on yli 14 miljoonaa sanaa
  - Tiivisteitä voidaan tehdä erilaisilla hajautusalgoritmeilla. Hashcatilla voi selvitellä mahdollisia käytettyjä algoritmeja: `hashid -m <tiiviste>`
  - Parametri -m näyttää hashid-analyysissa numeron, jota voidaan myös käyttää Hashcatissa purkamaan valitun algoritmin perusteella, esim. md5 -> 0, SHA256 -> 1400
  - Esimerkit käytöstä, näistä lisää kohdassa d) Cheatsheet. (ja aiemmissa läksykohdissa)
  - Jos käyttö on omaan makuun liian hidasta, näitä voi ajaa hostikoneella. Näytönohjaimen hyödyntäminen murtamisessa saattaa nopeuttaa hashcatin toimintaa.
    
##### Karvinen 2023: [Crack File Password With John](https://terokarvinen.com/2023/crack-file-password-with-john/)
  - Kuten Hashcat, myös John the Ripper on salasanojen murtoihin erikoistuva ohjelma
  - Jumbo-versiolla onnistuu monimutkaisemmat murtamiset, kuten salasanoilla suojattujen zip-pakettien salasanojen murtaminen
  - Asennus ja käyttöönotto:

```

$ sudo apt-get update
// Avaan asennuskomennon asentamat asiat cheatsheetissa, tuollaisenaan siinä tulee toiminnallisuuksia, jotka jo löytyvät esim. testauksessa käytetystä Kali Linuxista (esim. bash-completion)
$ sudo apt-get -y install micro bash-completion git build-essential libssl-dev zlib1g zlib1g-dev zlib-gst libbz2-1.0 libbz2-dev atool zip wget
// --depth=1 lataa vain uusimmat versiot, ei koko repoa
$ git clone --depth=1 https://github.com/openwall/john.git

$ cd john/src/
// Jos puuttuu riippuvaisuuksia, tässä kohtaa tulee siitä ilmoituksia. Kannattanee asentaa mahdolliset puuttuvat kirjastot.
$ ./configure
// Koodin kompilointi
$ make -s clean && make -sj4
// Kompiloinnin jälkeen Johnin voi laittaa pyörimään. Jos saat versiotiedon, se on mitä luultavammin käyttövalmis
$ $HOME/john/run/john 

```

  - Kuten aiemmin sanottu, Johnilla voi murtaa monenlaisia tiedostoja: `1password 7z DPAPImk adxcsouf aem aix aix andotp androidbackup androidfde ansible apex apop applenotes aruba atmail axcrypt bestcrypt bestcryptve bitcoin bitlocker bitshares bitwarden bks blockchain cardano ccache cisco cracf dashlane deepsound diskcryptor dmg dmg ecryptfs ejabberd electrum encdatavault encfs enpass ethereum filezilla geli gpg hccap hccapx htdigest ibmiscanner ikescan itunes_backup iwork kdcdump keepass keychain keyring keystore kirbi known_hosts krb kwallet lastpass ldif libreoffice lion lion lotus luks mac mac mcafee_epo monero money mongodb mosquitto mozilla multibit neo network office openbsd_softraid openssl padlock pcap pdf pem pfx pgpdisk pgpsda pgpwde prosody ps_token pse putty pwsafe racf radius radius rar restic sap sense signal sipdump ssh sspr staroffice strip telegram test_tezos tezos truecrypt uaf vdi vmx wpapcap zed zip`
  - Ohjeet sisältävät esimerkkinä zippitiedoston, jonka salasanan voi kokeilla murtaa. Vaikuttaa kivalta kohteelta b)-kohtaan!

---

#### a) Hashcat. Asenna Hashcat ja testaa sen toimivuus ratkaisemalla tiiviste.

Hashcat tulee valmiiksi asennettuna Kali Linuxissa. Ajoin virtuaalikoneen käynnistyksen yhteydessä apt-get updaten, ja varmistin, että hashcat todella löytyy. Sen jälkeen kopioin myös rockyoun luotuun työkansioon:

```

┌──(susi㉿isopaha)-[~]
└─$ sudo apt-get update    

┌──(susi㉿isopaha)-[~]
└─$ hashcat                                                                         
Usage: hashcat [options]... hash|hashfile|hccapxfile [dictionary|mask|directory]...

Try --help for more help.

┌──(susi㉿isopaha)-[~]
└─$ mkdir crackhash 
                                                                                            
┌──(susi㉿isopaha)-[~]
└─$ cd crackhash 

┌──(susi㉿isopaha)-[~/crackhash]
└─$ wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz
[...leikattu tulostetta...]
rockyou.txt.tar.gz     100%[============================>]  50.82M  11.0MB/s    in 4.6s    

2023-12-06 00:33:20 (11.0 MB/s) - ‘rockyou.txt.tar.gz’ saved [53291283/53291283]


```

Komento `tar xf` ajaa tar-ohjelman, tarin man-sivujen mukaan x extractaa (purkaa) ja f määrittää purettavan tiedoston nimeksi arkiston nimen.

```

-x, --extract, --get
              Extract  files  from an archive.  Arguments are optional.  When given, they
              specify names of the archive members to be extracted.

[...]

 -f, --file=ARCHIVE
              Use  archive file or device ARCHIVE.  If this option is not given, tar will
              first examine the environment variable ‘TAPE’.  If it  is  set,  its  value
              will be used as the archive name.  Otherwise, tar will assume the compiled‐
              in default.  The default value can be inspected either using the --show-de‐
              faults option, or at the end of the tar --help output.

```

![image](https://github.com/sawulohi/PenTest/assets/117188828/66f05845-2cb0-4ed5-b2d2-405fcdb89c7b)

Sitten ajellaan. Kokeillaan alkuun [Teron artikkelissa](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/) mainittua tiivistettä `6b1628b016dff46e6fa35684be6acc96`

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashid -m 6b1628b016dff46e6fa35684be6acc96                                
Analyzing '6b1628b016dff46e6fa35684be6acc96'
[+] MD2 
[+] MD5 [Hashcat Mode: 0]
[+] MD4 [Hashcat Mode: 900]
[+] Double MD5 [Hashcat Mode: 2600]
[+] LM [Hashcat Mode: 3000]
[+] RIPEMD-128 
[+] Haval-128 
[+] Tiger-128 
[+] Skein-256(128) 
[+] Skein-512(128) 
[+] Lotus Notes/Domino 5 [Hashcat Mode: 8600]
[+] Skype [Hashcat Mode: 23]
[+] Snefru-128 
[+] NTLM [Hashcat Mode: 1000]
[+] Domain Cached Credentials [Hashcat Mode: 1100]
[+] Domain Cached Credentials 2 [Hashcat Mode: 2100]
[+] DNSSEC(NSEC3) [Hashcat Mode: 8300]
[+] RAdmin v2.x [Hashcat Mode: 9900]

```

Esimerkissä oli vähän tylsästi spoilattu, että kyseessä on md5-tiiviste

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashcat -m 0 6b1628b016dff46e6fa35684be6acc96 rockyou.txt 
hashcat (v6.2.6) starting

[...tulostetta pätkitty...]

Dictionary cache built:
* Filename..: rockyou.txt
* Passwords.: 14344391
* Bytes.....: 139921497
* Keyspace..: 14344384
* Runtime...: 1 sec

6b1628b016dff46e6fa35684be6acc96:summer                   
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 0 (MD5)


```

Totta tosiaan, tiiviste oli tehty md5-hajautusalgoritmilla, ja se oli tehty merkkijonosta 'summer'. Voisin vielä kokeilla esim. Metasploitablessa löytyneistä tiivisteistä. Koska olin laiskalla päällä, hain [Antti Halosen kotitehtävistä](https://github.com/therealhalonen/penetration_testing/blob/master/h1/report.md#n-vapaaehtoinen-murtaudu-johonkin-toiseen-metasploitablen-palveluun) valmiita tiivisteitä, jotka oli hankittu Metasploitablesta.
Hänen tehtävissään oli tehty tiivistelista seuraavanlaisista tiivisteistä:

```

$1$/avpfBJ1$x0z8w5UF9Iv./DR9E9Lid.
$1$fUX6BPOt$Miyc3UpOzQJqz4s5wFD9l0
$1$f2ZVMS4K$R9XkI.CmLdHhdUE3X9jqP0
$1$XN10Zj2c$Rt/zzCW3mLtUWA.ihZjA5/
$1$Rw35ik.x$MgQgZUuO5pAoUvfJhfcYe/
$1$HESu9xrH$k.o3G93DGoXIiQKkPmUgZ0
$1$kR3ue7JZ$7GxELDupr5Ohp6cjZ3Bu//

```

Tein tiivisteistä tiedoston nimeltä `hashmenu`. Antin läksyistä ilmeni, että Hashcattia voisi ajaa vaikka kaikkiin tiivisteisiin kerralla! Kuulostaa mainiolta lähestymistavalta laiskalle ihmiselle.

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashid -m hashmenu                                       
--File 'hashmenu'--
Analyzing '$1$/avpfBJ1$x0z8w5UF9Iv./DR9E9Lid.'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$fUX6BPOt$Miyc3UpOzQJqz4s5wFD9l0'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$f2ZVMS4K$R9XkI.CmLdHhdUE3X9jqP0'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$XN10Zj2c$Rt/zzCW3mLtUWA.ihZjA5/'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$Rw35ik.x$MgQgZUuO5pAoUvfJhfcYe/'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$HESu9xrH$k.o3G93DGoXIiQKkPmUgZ0'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
Analyzing '$1$kR3ue7JZ$7GxELDupr5Ohp6cjZ3Bu//'
[+] MD5 Crypt [Hashcat Mode: 500]
[+] Cisco-IOS(MD5) [Hashcat Mode: 500]
[+] FreeBSD MD5 [Hashcat Mode: 500]
--End of file 'hashmenu'--        

```

Kaikki tiedostot kertovat vain yhtä ja ainoaa totuutta, md5-algoritmi ja koodi 500 ovat avainasemassa purkamiseen. Koitetaan purkaa tiivisteet rockyoulla omaan tiedostoonsa:

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashcat -m 500 hashmenu -o puretut

```

Lippu `-o`vie tulokset tiedostoon, jonka nimeksi annoin puretut. Lippu `-m` avattiin jo aiemmin, mutta se tosiaan viittaa käytettävään tiivistealgoritmiin. Hashcat pureskeli kansiota jonkin aikaa, ehkä muutamia minuutteja. 

```

No password candidates received in stdin mode, aborting

Session..........: hashcat
Status...........: Aborted
Hash.Mode........: 500 (md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5))
Hash.Target......: hashmenu
Time.Started.....: Wed Dec  6 00:59:31 2023 (2 mins, 1 sec)
Time.Estimated...: Wed Dec  6 01:01:32 2023 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: Pipe
Speed.#1.........:        0 H/s (0.00ms) @ Accel:64 Loops:1000 Thr:1 Vec:4
Recovered........: 0/7 (0.00%) Digests (total), 0/7 (0.00%) Digests (new), 0/7 (0.00%) Salts

```

Voi nenä. Eipä onnistunut. Nähtävästi ainakin kansioissa tulee käyttää **hyökkäystilaa**, jota operoidaan lipulla -a [hyökkäysmetodin numero] -> `man hashcat`:

```

[...]

-a, --attack-mode=NUM
              Attack‐mode, see references below

[...]

Attack mode
       0 = Straight
       1 = Combination
       3 = Brute-force
       6 = Hybrid Wordlist + Mask
       7 = Hybrid Mask + Wordlist

```

Kokeillaan suoraa lähestymistapaa. Ei vaan hetkinen. En ollut myöskään määrittänyt käytettävää sanakirjaa. Ei ihmekkään, ettei sanoja löytynyt Laitetaan sekin ajettavaan komentoon.

```

┌──(susi㉿isopaha)-[~/crackhash]
└─$ hashcat -a 0 -m 500 hashmenu rockyou.txt -o puretut

```

Hashcat lähti pureskelemaan. Käyttöliittymä antoi minulle mahdollisuuden tarkistella etenemistä s-näppäimellä, jota painelin Hashcatin ajellessa.

```

Session..........: hashcat
Status...........: Running
Hash.Mode........: 500 (md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5))
Hash.Target......: hashmenu
Time.Started.....: Wed Dec  6 01:09:26 2023 (1 min, 21 secs)
Time.Estimated...: Wed Dec  6 04:20:24 2023 (3 hours, 9 mins)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:     5007 H/s (12.72ms) @ Accel:256 Loops:250 Thr:1 Vec:4
Recovered........: 3/7 (42.86%) Digests (total), 0/7 (0.00%) Digests (new), 3/7 (42.86%) Salts
Progress.........: 709376/100410688 (0.71%)
Rejected.........: 0/709376 (0.00%)
Restore.Point....: 101120/14344384 (0.70%)
Restore.Sub.#1...: Salt:6 Amplifier:0-1 Iteration:750-1000
Candidate.Engine.: Device Generator
Candidates.#1....: jyothi -> ilovegus
Hardware.Mon.#1..: Util:100%

[s]tatus [p]ause [b]ypass [c]heckpoint [f]inish [q]uit => 

```

Tulosteesta päätellen tässä vaiheessa oli jo purettu onnistuneesti 3/7 tiivistettä. Progress näytti uhkaavan pieneltä (0.71%), joten harkitsin ajamisen keskeyttämistä. Myös Time.estimated antoi arvioksi 3 tuntia, joten päätin tyytyä pienempään määrään purettuja tiivisteitä. Painoin `f` niin kuin finish päättääkseni murtamiskierroksen.

```

Finish enabled. Will quit after this attack.
// Painoin tässä kohtaa epähuomiossa ctrl + c, joka lopetti prosessin hetimmiten.
[s]tatus [p]ause [b]ypass [c]heckpoint [f]inish [q]uit => ^C

┌──(susi㉿isopaha)-[~/crackhash]
└─$ cat puretut                                        
$1$f2ZVMS4K$R9XkI.CmLdHhdUE3X9jqP0:123456789
$1$fUX6BPOt$Miyc3UpOzQJqz4s5wFD9l0:batman
$1$kR3ue7JZ$7GxELDupr5Ohp6cjZ3Bu//:service

```

Sain kolme salasanatiivistettä auki! Jatkokehitysideana olisi päivittää päätoiminen käyttöjärjestelmä Linuxiin, taikka allokoida virtuaalikoneelle enemmän tehoja esim. näytönohjaimesta, jos sellainen on VirtualBoxissa mahdollista. Vaihtoehtoisesti voisi käyttää kohdistetumpaa sanalistaa, kenties jotain joka kohdistuu nimenomaisesti Metasploitableen.

#### b) John. Asenna Jumbo John ja testaa sen toimivuus murtamalla jonkin tiedoston salasana.
#### c) f5bc7fcc7f5b3b6af7ff79e0feafad6d1a948b6a2c18de414993c1226be48c1f on erään tällä tehtäväsivulla olevan yksittäisen sanan tiiviste. Käytin hyvin yleistä ja tunnettua tiivistealgoritmia. Sanassa voi olla isoja kirjaimia, mutta ei erikoismerkkejä. Minkä sanan tiiviste on kyseessä?
#### d) Cheatsheet. Kerää kurssilaisten raporteista käteviä tekniikoita. Kerää itse tekniikat ja komennot, älä pelkästään kuvaile. Muista lähdeviitteet. Tee tiivis ja selkeä cheatsheet, josta löydät tarvittavat tiedot lipunryöstössä. (Tässä alatehtävässä ei tarvitse tehdä testejä koneella)
#### e) Viittaa. Tarkista, että jokaisessa raportissasi on lähdeviitteet kunnossa. Jokaisen raportin tulee viitata ainakin kurssiin / tehtäväsivuun. Kaikkiin muihinkin käytettyihin lähteisiin tulee viitata, kuten kurssikavereiden raportteihin, weppisivuihin, man-sivuihin... (Tässä alatehtävässä ei tarvitse tehdä testejä koneella).
