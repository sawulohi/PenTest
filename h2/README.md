Testaukset tehty Windows 10 käyttöjärjestelmällä, Version 10.0.19045 Build 19045. Tämän lisäksi käytetty myös Kali Linux versio 2023.3 ajettuna VirtualBoxin versio 6.1 kautta,  Prosessorina Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz, 16GB RAM

[https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h1-hacker-warmup](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h1-hacker-warmup)

#### x\) Lue/katso ja tiivistä.

Koska aihe oli minulle uusi, otin laajemmat muistiinpanot tulevia tehtäviä varten jo nyt.

  - [Hoikkala "joohoi" 2020: Still Fuzzing Faster (U fool). In HelSec Virtual meetup #1.](https://www.youtube.com/watch?v=mbmsT3AhwWU)
    - Esityksen pitäjänä "joohoi" Hoikkala, ffuf:in kehittäjä
    - Web fuzzing on HTTP-pyyntöjen lähettämistä palvelimelle
      - Pyyntöjä voidaan lähettää suuria määriä (jopa miljoonia)
      - Suodattaminen tapahtuu käyttäjän asettamien suodattimien mukaisesti
      - Samoin esim. subdomainien etsimiseen käytettävät kirjastot
      - Input contenttina voidaan antaa esim.
        * Salasanalistoja, käyttäjälistoja
        * Tunnettuja rajapintareittejä
        * Yleisiä resurssipolkuja, parametrien nimiä ja arvoja
        * Validin input datan mutaatioita
    - Tarkoituksena on saada palvelimelta vastauksia pyyntöihin, ja siten kartoittaa esim. palvelimen sisältöä
    - Yleisiä kohteita: 
      * GET-parametrit: nimet, arvot tai molemmat
      * Headerit: host, autentikaatio, keksit, proxy headerit
      * POST data: lomaketietoja, JSON, tiedostoja
    - Suodattimien lisäksi käytetään myös "matchereita", eli yhteneväisyyksiä
      - Matchereissa voidaan hyödyntää esim. sisältöä (regexejä), vastausten kokoa byteissä
    - Muita fuzzaus-työkaluja esim:
      * Burp
      * OWASP Zap
      * dirbuster
      * gobuster
    - Syy ffuf:n kehittämiseen oli gobusterin branchien refaktoroinnissa, joohoi olisi halunnut tehdä siihen committeja, mutta pyydettiin jarruttelemaan -> teki ffuf:n
    - Muutama demo:
      - `ffuf -w ~/SecLists/Discovery/Web-Content/big.txt -u https://ffuf.io.fi/FUZZ -e .php -c -v`
        * -w käytettävä sanalista polkuineen 
        * -u kohteen url
        * -e .php sisällyttää .php-tiedostopäätteen
        * -c värittää tekstin
        * -v verbose, eli selkokielinen (ihmisten käyttämä kieli) output
        * (-recursion lisää rekursiivisuuden, eli laajentaa pyynnöt kaikkiin hakemistoihin ja niiden alahakemistoihin, kestää joskus todella kauan)
        * big.txt sisältää laajan kattauksen
      - `curl -v -X POST https://ffuf.io/login.php -d 'username=something&password=somethingelse`
        * Pyyntö kirjautua sivustolle, johti errored statukseen
      - `ffuf -c -X POST -H "Content-Type: applivation/x-www-form-urlencoded -d 'username=USER&password=PASS' -u https://ffuf.io.fi/login.php -fr 'errored' -v -w users.txt:USER -w ~/SecLists/Passwords/darkweb2017-top10000.txt:PASS`
        * -X POST - HTTP POST-pyyntö
        * -H "Conte[...] - sisältötyyppi, vaaditaan koska moni lomakkeiden handler skippaisi pyynnöt jos tämä on määritelty väärin (määrittelemätön?)
        * -d 'username=USER&password=PASS' - capslockilla kirjoitetut kohdat haetaan sanalistoista
        * -fr 'errored - suodattaa pois 'errored'-tilassa palaavat vastaukset (fr = filter response?)
        * -w users.txt:USER <- kohdistaa sanalistan USER "muuttujaan"
      - `ffuf -c -u https://USER:PASS@ffuf.io.fi/secure/ -v -w users.txt:USER -w ~/SecLists/Passwords/darkweb2017-top10000.txt:PASS -fc 401`
        * -fc 401 filtteröi ulos vastaukset jotka tulevat ulos 401 koodilla (auth epäonnistui)
        * ffuf:in tulos antoi onnistuneen vastauksen (status 200), user joohoi, password hunter1
      - Headerien fuzzaus `-H "Host: FUZZ.ffuf.io.fi`
        * -fs 16, filter size 16 - epäonnistunut demo, oikea käyttö jäi epäselväksi
      - Parametreihin esim.: `seq 1 10000 |fuff -c -v -u https://ffuf.io.fi/content.php?id=FUZZ -w - -fs 12 -od id_fuzz`
        * seq on GNU-työkalu joka käy numeroiden välin järjestyksessä
        * putki | vie sen fuffiin
        * -w - käyttää sanalistana seq:iä
        * -fs 12 filtteröi pois 12 byten vastaukset
        * -od id_fuzz vie tulokset erillisiin tiedostoihin jotka sisältävät pyynnöt ja vastaukset
    - [https://github.com/danielmiessler/SecLists](https://github.com/danielmiessler/SecLists) sanalistoja varten
    - joohoi panee oluita, esityksessään hän joi itsetehtyä Bock double ipaa

  -  Lyon 2009: Nmap Network Scanning: Chapter 15. Nmap Reference Guide:
      *  [Port Scanning Basics](https://nmap.org/book/man-port-scanning-basics.html) (opettele, mitä tarkoittavat: open, closed, filtered; muuten vain silmäily)
        - open: Applikaatio ottaa paketteja vastaan aktiivisesti. Yleisin maalitaulu porttiskannauksissa. Pentestaajat etsivät tietä sisään, adminit yrittävät tulimuurittaa pääsyn vaan sallituille
        - closed: Portti on saavutettavissa, mutta mikään applikaatio ei kuuntele sitä. Saattavat aueta myöhemmin, joten kuuntelu voi olla kannattavaa
        - filtered: Nmap ei saa tietoa portin avoimuudesta. Tulimuuri/reitittimen säännöt/hostipohjainen tulimuuri välissä. Vähän tietoa saatavissa, hidastavat skannaamista

      *  [Port Scanning Techniques](https://nmap.org/book/man-port-scanning-techniques.html) (opettele, mitä ovat: -sS -sT -sU; muuten vain silmäily)
        - sS: TCP SYN scan - suosituin, nopein, hienovarainen (unobstrusive) ja vaivihkainen. Ei koskaan tee TCP-yhteyksiä loppuun asti - pelkkä SYN paketti & SYN/ACK takaisin
        - sT: TCP connect scan - muodostaa TCP-yhteyden samaan tapaan kuin esim. nettiselaimet tai peer to peer-clientit. Huomattavampi toimenpide kuin esim. SYN scan - jättää selkeät jäljet yhteyksistä kohteen lokeihin.
        - sU: UDP scans - erityisesti DNS (53), SNMP (161/162) ja DHCP (67/68) käyttävät UDP:tä. Skannaus lähettää UDP-paketin jokaiseen kohdeporttiin. Paketin sisältö voidaan määritellä parametreillä kuten --data. Skannaus on usein hidas -> voi johtaa nmapin timeouttiin. Suljetut portit taas usein lähettävät takaisin ICMP unreachable -viestin.

#### a\) Fuff. Ratkaise [Teron ffuf-haastebinääri](https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/?fromSearch=ffuf#your-turn---challenge).

Testasin ensin, onko ffuf esiasennettuna Kali Linuxissa, ja olihan se:

```
┌──(kali㉿kali)-[~]
└─$ ffuf 
Encountered error(s): 2 errors occurred.
        * -u flag or -request flag is required
        * Either -w or --input-cmd flag is required

Fuzz Faster U Fool - v2.1.0-dev

HTTP OPTIONS:
  -H                  Header `"Name: Value"`, separated by colon. Multiple -H flags are accepted.
  -X                  HTTP method to use
  -b                  Cookie data `"NAME1=VALUE1; NAME2=VALUE2"` for copy as curl functionality.
  -cc                 Client cert for authentication. Client key needs to be defined as well for this to work
  -ck                 Client key for authentication. Client certificate needs to be defined as well for this to work
  -d                  POST data
  -http2              Use HTTP2 protocol (default: false)
  -ignore-body        Do not fetch the response content. (default: false)
  -r                  Follow redirects (default: false)
  -raw                Do not encode URI (default: false)
  -recursion          Scan recursively. Only FUZZ keyword is supported, and URL (-u) has to end in it. (default: false)
  -recursion-depth    Maximum recursion depth. (default: 0)
  -recursion-strategy Recursion strategy: "default" for a redirect based, and "greedy" to recurse on all matches (default: default)
  -replay-proxy       Replay matched requests using this proxy.
  -sni                Target TLS SNI, does not support FUZZ keyword
  -timeout            HTTP request timeout in seconds. (default: 10)
  -u                  Target URL
  -x                  Proxy URL (SOCKS5 or HTTP). For example: http://127.0.0.1:8080 or socks5://127.0.0.1:8080

GENERAL OPTIONS:
  -V                  Show version information. (default: false)
  -ac                 Automatically calibrate filtering options (default: false)
  -acc                Custom auto-calibration string. Can be used multiple times. Implies -ac
  -ach                Per host autocalibration (default: false)
  -ack                Autocalibration keyword (default: FUZZ)
  -acs                Custom auto-calibration strategies. Can be used multiple times. Implies -ac
  -c                  Colorize output. (default: false)
  -config             Load configuration from a file
  -json               JSON output, printing newline-delimited JSON records (default: false)
  -maxtime            Maximum running time in seconds for entire process. (default: 0)
  -maxtime-job        Maximum running time in seconds per job. (default: 0)
  -noninteractive     Disable the interactive console functionality (default: false)
  -p                  Seconds of `delay` between requests, or a range of random delay. For example "0.1" or "0.1-2.0"
  -rate               Rate of requests per second (default: 0)
  -s                  Do not print additional information (silent mode) (default: false)
  -sa                 Stop on all error cases. Implies -sf and -se. (default: false)
  -scraperfile        Custom scraper file path
  -scrapers           Active scraper groups (default: all)
  -se                 Stop on spurious errors (default: false)
  -search             Search for a FFUFHASH payload from ffuf history
  -sf                 Stop when > 95% of responses return 403 Forbidden (default: false)
  -t                  Number of concurrent threads. (default: 40)
  -v                  Verbose output, printing full URL and redirect location (if any) with the results. (default: false)

MATCHER OPTIONS:
  -mc                 Match HTTP status codes, or "all" for everything. (default: 200-299,301,302,307,401,403,405,500)
  -ml                 Match amount of lines in response
  -mmode              Matcher set operator. Either of: and, or (default: or)
  -mr                 Match regexp
  -ms                 Match HTTP response size
  -mt                 Match how many milliseconds to the first response byte, either greater or less than. EG: >100 or <100
  -mw                 Match amount of words in response

FILTER OPTIONS:
  -fc                 Filter HTTP status codes from response. Comma separated list of codes and ranges
  -fl                 Filter by amount of lines in response. Comma separated list of line counts and ranges
  -fmode              Filter set operator. Either of: and, or (default: or)
  -fr                 Filter regexp
  -fs                 Filter HTTP response size. Comma separated list of sizes and ranges
  -ft                 Filter by number of milliseconds to the first response byte, either greater or less than. EG: >100 or <100
  -fw                 Filter by amount of words in response. Comma separated list of word counts and ranges

INPUT OPTIONS:
  -D                  DirSearch wordlist compatibility mode. Used in conjunction with -e flag. (default: false)
  -e                  Comma separated list of extensions. Extends FUZZ keyword.
  -enc                Encoders for keywords, eg. 'FUZZ:urlencode b64encode'
  -ic                 Ignore wordlist comments (default: false)
  -input-cmd          Command producing the input. --input-num is required when using this input method. Overrides -w.
  -input-num          Number of inputs to test. Used in conjunction with --input-cmd. (default: 100)
  -input-shell        Shell to be used for running command
  -mode               Multi-wordlist operation mode. Available modes: clusterbomb, pitchfork, sniper (default: clusterbomb)
  -request            File containing the raw http request
  -request-proto      Protocol to use along with raw request (default: https)
  -w                  Wordlist file path and (optional) keyword separated by colon. eg. '/path/to/wordlist:KEYWORD'

OUTPUT OPTIONS:
  -debug-log          Write all of the internal logging to the specified file.
  -o                  Write output to file
  -od                 Directory path to store matched results to.
  -of                 Output file format. Available formats: json, ejson, html, md, csv, ecsv (or, 'all' for all formats) (default: json)
  -or                 Don't create the output file if we don't have results (default: false)

EXAMPLE USAGE:
  Fuzz file paths from wordlist.txt, match all responses but filter out those with content-size 42.
  Colored, verbose output.
    ffuf -w wordlist.txt -u https://example.org/FUZZ -mc all -fs 42 -c -v

  Fuzz Host-header, match HTTP 200 responses.
    ffuf -w hosts.txt -u https://example.org/ -H "Host: FUZZ" -mc 200

  Fuzz POST JSON data. Match all responses not containing text "error".
    ffuf -w entries.txt -u https://example.org/ -X POST -H "Content-Type: application/json" \
      -d '{"name": "FUZZ", "anotherkey": "anothervalue"}' -fr "error"

  Fuzz multiple locations. Match only responses reflecting the value of "VAL" keyword. Colored.
    ffuf -w params.txt:PARAM -w values.txt:VAL -u https://example.org/?PARAM=VAL -mr "VAL" -c

  More information and examples: https://github.com/ffuf/ffuf

Encountered error(s): 2 errors occurred.
        * -u flag or -request flag is required
        * Either -w or --input-cmd flag is required


```

Latasin annetun harjoitusmaalin [weppisivulta](https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/?fromSearch=ffuf#your-turn---challenge). Vaihdoin sen käyttöoikeuksiin suorittamisen käyttäjälle, ja latasin myös [Seclists sanakirjan](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt), jonka Daniel Miessler (ja muut) ovat tehneet valmiiksi.

```

┌──(kali㉿kali)-[~]
└─$ cd Downloads  
                                                                             
┌──(kali㉿kali)-[~/Downloads]
└─$ ls -l
total 2544
-rw-r--r-- 1 kali kali 2603332 Nov  4 17:48 dirfuzt-1
                                                                             
┌──(kali㉿kali)-[~/Downloads]
└─$ chmod u+x dirfuzt-1 
                                                                             
┌──(kali㉿kali)-[~/Downloads]
└─$ ls -l              
total 2544
-rwxr--r-- 1 kali kali 2603332 Nov  4 17:48 dirfuzt-1
                                                                             
┌──(kali㉿kali)-[~/Downloads]
└─$ wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt
--2023-11-04 17:52:26--  https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.109.133, 185.199.110.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 38086 (37K) [text/plain]
Saving to: ‘common.txt’

common.txt          100%[================>]  37.19K  --.-KB/s    in 0.006s  

2023-11-04 17:52:27 (6.57 MB/s) - ‘common.txt’ saved [38086/38086]

```

Koska testaukset tehdään lokaalisti, virheiden välttämiseksi otin virtuaalikoneesta verkkoyhteyden pois käytöstä. Tämä onnistui klikkaamalla oikealla hiiren painikkeella kahta näytön kuvaa Virtualboxin alalaidasta, ja sitten valitsemalla `connect network adapter`. Testasin vielä nettiyhteyden toimimattomuuden selaamalla Firefoxilla ylen sivuille:

![1.png](images/1.png)

![2.png](images/2.png)





#### b\) Fuffme. Asenna [Ffufme harjoitusmaali](https://terokarvinen.com/2023/fuffme-web-fuzzing-target-debian/) paikallisesti omalle koneellesi. Ratkaise tehtävät (kaikki paitsi ei "Content Discovery - Pipes")