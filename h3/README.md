Testaukset tehty Windows 10 käyttöjärjestelmällä, Version 10.0.19045 Build 19045. Tämän lisäksi käytetty myös Kali Linux versio 2023.3 ajettuna VirtualBoxin versio 6.1 kautta,  Prosessorina Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz, 16GB RAM

[https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h3-lab-kid](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h3-lab-kid)

#### x\) Lue/katso ja tiivistä.

##### € Velu 2022: Mastering Kali Linux for Advanced Penetration Testing 4ed: Chapter 10 - Exploitation: kappaleet "The Metasploit Framework", "The exploitation of targets using Metasploit" ja "Using public exploits". Eli ei enää kappaletta "Developing a Windows exploit" ja siitä eteenpäin.

  - Metasploit Framework (MSF) on avoimeen lähdekoodiin perustuva työkalu joka on suunniteltu toimimaan penetraatiotestauksessa.
  - Modulaarinen lähestymistapa erilaisten hyökkäysten toimittamiseen
    - Sisältää:
      - Kirjastoja (esim. REX, joka käsittelee mm. socket-yhteyksiä)
      - Käyttöliittymiä (esim. `msfconsole`, tähän tutustutaan myöhemmin)
      - Moduuleita (esim. hyökkäykset, hyötykuormat, encoderit)
  - Toiminta pähkinänkuoressa: käynnistä -> luo työtila hyökkäämistä varten -> skannaa kohde -> valitse haavoittuvuus -> valitse ja aja hyökkäys
  - Sisältää esimerkkiohjeet yksinkertaiseen reverse shelliin Meterpreterillä
    - Sessioiden pyörittäminen taka-alalla: `"Run Meterpreter in the background by pressing Ctrl + Z. You should receive Background session 1? [y/N] y enter y."`
  - Sisältää ohjeet useamman kohteen exploittaamiseen kerralla
  - Julkisten exploittien käyttö esim. Exploit-DB (tietokanta julkisista haavoittuvuuksista), SearchSploit (Kali Linuxissa löytyvä hakukone Exploit-DB:tä varten)


##### Vapaavalintainen läpikävely 0xdf tai ippsec (Kannattaa valita helppo; esim "Base Points: Easy")

[https://0xdf.gitlab.io/2023/02/11/htb-photobomb.html](https://0xdf.gitlab.io/2023/02/11/htb-photobomb.html)

  - [HackTheBoxin](https://www.hackthebox.com/) viikottaisissa haastekoneissa helppojen alla
  - Recon nmapilla, portit 22 ja 80 auki - 80 redirectaa sivustolle photobomb.htp
  - Fuzzaus ffuffilla ei johda mihinkään
  - Sivustolla on HTTP kirjautumislomake
  - Sivuston JavaScript-tiedosto sisältää käyttäjätunnuksen ja salasanan
  - Kirjautuneena voi pyytää sivustolta latauslinkkiä kuviin, ja hyökkääjä kokeilee näihin komentoinjektioita
  - Injektiolla hyökkääjä curlaa oman weppiserverinsä ja ajaa sieltä reverse shellin käynnistävän bash-skriptin
  - Hyökkääjäkoneella kuunnellaan netcatilla, saadaan yhteys, tehdään [shellin päivitys (YouTube-linkki)](https://www.youtube.com/watch?v=DqE6DxqJg8Q)
  - Uhrilla oleva skripti sisältää avonaisen `enable -n [ `-kohdan, jonka loppuosa on kommentoitu pois. Tätä vivuttamalla hyökkääjä saa koneeseen rootit
  
  ##### Nyrkkeilysäkki ei kuulu. Etsi hakukoneesta kotitehtäväraportti, jossa Kali ja Metasploitable on asennettu samaan verkkooon VirtualBoxiin; sekä testaamalla osoitettu, että koneet on saatu irti Internetistä.

  - [https://github.com/therealhalonen/penetration_testing/blob/master/h1/report.md](https://github.com/therealhalonen/penetration_testing/blob/master/h1/report.md) Antti Halosen viime kevään toteutuksella tehty vastaava raportti. Käytän näitä ohjeita läksyjä tehdessäni.

#### a\) Asenna Kali virtuaalikoneeseen

Olin jo asentanut Kalin aiemmin, mutta tehdään virtuaaliverkkoa varten oma asennus.

  1. Lataa itsellesi sopiva versio [Kalista](https://www.kali.org/get-kali/). Itse valitsin [64-bit Installer imagen](https://cdimage.kali.org/kali-2023.3/kali-linux-2023.3-installer-amd64.iso), jotta voin klikkailla menemään kaikki asennuksen vaiheet itse.
  2. Valmistele kone Virtualboxissa: New (ctrl + N) -> asetin nimeksi "susi" ja laitoin välimuistin määräksi 8192MB. Valitsin myös vaihtoehdon kovalevyn luomiseksi asennuksen yhteydessä. -> Create -> Annoin asennuspolun mennä oletusarvoisella arvolla, mutta kovalevyn kooksi laitoin 20GB, kovalevyn tyypiksi VDI ja tallennustilan dynaamiseksi.

![1](img/1.png)

  3. Määrittelin Settingsistä vielä Antti Halosen ohjeita hyödyntäen verkkoa varten valmiiksi kaksi eri verkkoliitintä:
    * Adapter 1: NAT (Yhteys ulkoverkkoon kohtaa c\) varten)
    * Adapter 2: Host-Only Adapter #3. Tämän adapterin tein Virtualboxin kohdasta File -> Host Network Manager. Säädin sen palvelimeksi 192.168.66.1 ja osoiteavaruudeksi 192.168.66.2-254

![4](img/4.png)

  4. Käynnistin virtuaalikoneen ja valitsin kalin .iso-tiedoston asennusmediaksi. Seuraavissa asennusvaiheissa Install (ei graphical) -> kieleksi englanti, sijainniksi ja näppäimistön kieleksi suomi -> hostiksi 'isopaha' ja käyttäjäksi 'susi' (sekä turvallinen salasana), muihin valintoihin oletusasetukset. Asennuksessa kesti muutamia minuutteja.

#### b\) Asenna Metasploitable 2 virtuaalikoneeseen
#### c\) Tee koneille virtuaaliverkko, jossa

  *  Kali saa yhteyden Internettiin, mutta sen voi laittaa pois päältä
  *  Kalin ja Metasploitablen välillä on host-only network, niin että porttiskannatessa ym. koneet on eristetty intenetistä, mutta ne saavat yhteyden toisiinsa
  *  Osoita eri komennoilla, että Internet-yhteys katkeaa: 'ping 1.1.1.1', 'ping www.google.com', 'curl www.google.com'

#### d\) Etsi Metasploitable porttiskannaamalla (db_nmap -sn). Tarkista selaimella, että löysit oikean IP:n - Metasploitablen weppipalvelimen etusivulla lukee Metasploitable. Katso, ettei skannauspaketteja vuoda Internetiin - kannattaa irrottaa koneet netistä skannatessa.
#### e\) Porttiskannaa Metasploitable huolellisesti (db_nmap -A -p0-). Analysoi tulos. Kerro myös ammatillinen mielipiteesi (uusi, vanha, tavallinen, erikoinen), jos jokin herättää ajatuksia.
#### f\) Murtaudu Metasploitablen VsFtpd-palveluun Metasploitilla (search vsftpd, use 0, set RHOSTS - varmista osoite huolella, exploit, id)
#### g\) Parempi sessio. Tee vsftpd-hyökkäyksestä saadusta sessiosta parempi. (Voit esimerkiksi päivittää sen meterpreter-sessioksi, laittaa tty:n toimimaan tai tehdä uuden käyttäjän ja ottaa yhteyden jollain tavallisella protokollalla)
#### h\) Etsi, tutki ja kuvaile jokin hyökkäys ExploitDB:sta. (Tässä harjoitustehtävässä pitää hakea ja kuvailla hyökkäys, itse hyökkääminen jää vapaaehtoiseksi lisätehtäväksi)
#### i\) Etsi, tutki ja kuvaile hyökkäys 'searchsploit' -komennolla. Muista päivittää. (Tässä harjoitustehtävässä pitää hakea ja kuvailla hyökkäys, itse hyökkääminen jää vapaaehtoiseksi lisätehtäväksi. Valitse eri hyökkäys kuin edellisessä kohdassa.)
#### j\) Kokeile vapaavalintaista haavoittuvuusskanneria johonkin Metasploitablen palveluun. (Esim. nikto, wpscan, openvas, nessus, nucleus tai joku muu)
#### k\) Kokeile jotain itsellesi uutta työkalua, joka mainittiin x-kohdan läpikävelyohjeessa.